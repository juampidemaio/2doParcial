import{a as Ue,b as F,c as we,d as qe}from"./chunk-AV5DWBYN.js";import{$ as Ae,A as _e,Aa as Y,B as xe,C as Ee,H as ke,J as Fe,M as z,N as R,P as De,Q as Se,U as j,W as Ce,X as te,Y as H,Z as ie,_ as ne,a as q,aa as Ve,b as N,ba as oe,c as Z,ca as Ne,d as I,da as ze,e as k,ea as Re,f as ee,fa as je,g as v,ga as He,h as _,ha as $e,ia as Be,j as be,ja as Ge,k as l,l as x,m as S,n as u,o as n,oa as Le,p as o,q as W,qa as $,r as E,s as h,t as m,ta as B,u as ve,va as ye,w as r,x as f,xa as Te,y as G,ya as y,z as M,za as J}from"./chunk-TTNUA2XE.js";import{a as O,b as Oe,d as Q,f as d}from"./chunk-YYD2Q6U2.js";var L=Q(J());var D=class c{constructor(t){this.firestore=t}getEspecialistasPorEspecialidad(t){return d(this,null,function*(){let e=$(this.firestore,"users"),a=(yield B(e)).docs.map(s=>O({id:s.id},s.data())).filter(s=>this.especialistaValido(s,t));return console.log("Especialistas filtrados:",a),a})}getEspecialistas(){return d(this,null,function*(){let t=$(this.firestore,"users"),e=ye(t,Te("role","==","especialista")),a=(yield B(e)).docs.map(s=>O({id:s.id},s.data()));return console.log("Especialistas filtrados:",a),a})}especialistaValido(t,e){return t.role==="especialista"&&t.especialidades.includes(e)}getPacientesUnicosPorEspecialidad(t,e){return d(this,null,function*(){let i=$(this.firestore,"Turnos"),a=yield B(i),s=new Set,p=[],b=a.docs.map(P=>{let X=P.data();return O({id:P.id},X)}).filter(P=>{let X=P.especialista_id===t,Me=P.especialidad===e;return X&&Me&&s.add(P.pacienteId),X&&Me});console.log("Turnos solicitados:",b);let V=Array.from(s);return yield this.getPacientesPorIds(V)})}getPacientesUnicosPorEspecialista(t){return d(this,null,function*(){let e=$(this.firestore,"Turnos"),i=yield B(e),a=new Set,s=[],p=i.docs.map(w=>{let P=w.data();return O({id:w.id},P)}).filter(w=>{let P=w.especialista_id===t;return P&&w.pacienteId&&a.add(w.pacienteId),P});console.log("Turnos solicitados:",p);let b=Array.from(a);return yield this.getPacientesPorIds(b)})}getPacientesPorIds(t){return d(this,null,function*(){let e=$(this.firestore,"users"),i=[];for(let a of t)if(a){let s=ye(e,Te("uid","==",a));(yield B(s)).forEach(b=>{let V=b.data();i.push(O({id:b.id},V))})}else console.warn("ID de paciente es undefined, omitiendo este ID.");return i})}getHorariosPorEspecialista(t){return d(this,null,function*(){let e=$(this.firestore,"horarios"),i=yield B(e),a=yield this.getTurnosPorEspecialista(t);return i.docs.map(s=>{let p=s.data();return O({id:s.id},p)}).filter(s=>s.especialistaId===t&&this.isWithinNext15Days(s.fecha)&&!this.isHorarioOcupado(s,a))})}getTurnosPorEspecialista(t){return d(this,null,function*(){let e=$(this.firestore,"turnos");return(yield B(e)).docs.map(a=>{let s=a.data();return O({id:a.id},s)}).filter(a=>a.especialistaId===t)})}isHorarioOcupado(t,e){let i=new Date(t.fecha),a=new Date(i);return a.setMinutes(a.getMinutes()+30),e.some(s=>{let p=new Date(s.fecha),b=new Date(p);return b.setMinutes(b.getMinutes()+30),p<a&&b>i})}isWithinNext15Days(t){let e=new Date(t),i=new Date,a=new Date;return a.setDate(i.getDate()+15),e>=i&&e<=a}static \u0275fac=function(e){return new(e||c)(I(Le))};static \u0275prov=N({token:c,factory:c.\u0275fac,providedIn:"root"})};function Je(c,t){if(c&1){let e=E();n(0,"div",13),h("click",function(){let a=v(e).$implicit,s=m();return _(s.onEspecialistaChange(a))}),W(1,"img",14),n(2,"span",15),r(3),o()()}if(c&2){let e=t.$implicit;l(),ve("alt",e.nombre),u("src",e.imageUrl||"default-image.jpg",be),l(2),M("",e.nombre," ",e.apellido,"")}}function Ke(c,t){if(c&1){let e=E();n(0,"div",16),h("click",function(){let a=v(e).$implicit,s=m();return _(s.onEspecialidadChange(a.nombre))}),W(1,"img",17),n(2,"span",18),r(3),o()()}if(c&2){let e=t.$implicit;l(),ve("alt",e.nombre),u("src",e.imageUrl||"default-image.jpg",be),l(2),f(e.nombre)}}function Xe(c,t){if(c&1){let e=E();n(0,"div",19),h("click",function(){let a=v(e).$implicit,s=m();return _(s.onDiaSeleccionado(a))}),n(1,"button",20),r(2),ke(3,"date"),o()()}if(c&2){let e=t.$implicit;l(2),f(Fe(3,1,e,"yyyy-MM-dd"))}}function Ze(c,t){if(c&1){let e=E();n(0,"div",19),h("click",function(){let a=v(e).$implicit,s=m();return _(s.onHorarioSeleccionado(a))}),n(1,"button",21),r(2),o()()}if(c&2){let e=t.$implicit;l(2),M("",e.horaInicio," - ",e.horaFin,"")}}function et(c,t){c&1&&(n(0,"div")(1,"label",22),r(2,"Paciente:"),o(),W(3,"input",23),n(4,"label",24),r(5,"DNI:"),o(),W(6,"input",25),n(7,"label",26),r(8,"Obra Social:"),o(),W(9,"input",27),o())}function tt(c,t){if(c&1){let e=E();n(0,"app-listado-paciente",28),h("usuarioSeleccionado",function(a){v(e);let s=m();return _(s.setPacienteData(a))}),o()}}var re=class c{constructor(t,e,i,a,s,p){this.especialidadService=t;this.especialistaService=e;this.turnoService=i;this.authService=a;this.fb=s;this.router=p;this.turnoForm=this.fb.group({especialidad:["",H.required],especialista:["",H.required],horario:["",H.required],paciente:["",H.required],dni:["",[H.required,H.pattern(/^[0-9]{8,}$/)]],obraSocial:["",H.required]})}especialistas=[];horarios=[];turnoForm;isAdmin=!1;isPaciente=!1;usuarioSeleccionado;obtenerIdPaciente;nombreEspecialista;especialiadaSeleccionada;idEspecialista;especialidadesDelEspecialista=[];diasDisponibles=[];horariosPorDia=[];selectedTurno;ngOnInit(){this.cargarEspecialistas(),this.checkUserRole()}cargarEspecialistas(){return d(this,null,function*(){try{this.especialistas=yield this.especialistaService.getEspecialistas(),console.log("Especialistas cargados:",this.especialistas)}catch(t){console.error("Error al cargar los especialistas:",t),L.default.fire("Error","No se pudieron cargar los especialistas","error")}})}getUser(){return d(this,null,function*(){return new Promise(t=>{this.authService.getUser().subscribe(t)})})}checkUserRole(){return d(this,null,function*(){this.authService.getUser().subscribe(t=>{t&&(this.isAdmin=t.role==="administrador",this.isPaciente=t.role==="paciente")})})}setPacienteData(t){return d(this,null,function*(){this.usuarioSeleccionado=t,t&&this.turnoForm.patchValue({paciente:t.nombre,dni:t.dni,obraSocial:t.obraSocial,especialista:""})})}onEspecialistaChange(t){return d(this,null,function*(){if(this.idEspecialista=t.uid,console.log("ID del especialista seleccionado:",this.idEspecialista),this.idEspecialista)try{this.especialidadesDelEspecialista=yield this.especialidadService.getEspecialidadesPorEspecialista(t),this.nombreEspecialista=`${t.nombre} ${t.apellido}`,console.log("Especialidades del especialista:",this.especialidadesDelEspecialista)}catch(e){console.error("Error al cargar las especialidades:",e),L.default.fire("Error","No se pudieron cargar las especialidades","error")}else this.especialidadesDelEspecialista=[]})}onEspecialidadChange(t){return d(this,null,function*(){if(this.especialiadaSeleccionada=t,this.turnoForm.patchValue({horario:""}),this.horarios=[],this.diasDisponibles=[],t)try{let e=yield this.turnoService.obtenerTurnosDisponibles(this.idEspecialista,t),i=new Date,a=e.filter(s=>new Date(s.fecha)>=i);this.diasDisponibles=[...new Set(a.map(s=>s.fecha))],this.diasDisponibles.sort((s,p)=>new Date(s).getTime()-new Date(p).getTime()),this.horariosPorDia=a}catch{L.default.fire("Error","No se pudieron cargar los horarios","error")}})}onDiaSeleccionado(t){return d(this,null,function*(){this.horarios=this.horariosPorDia.filter(e=>e.fecha===t&&e.estado==="disponible").map(e=>({horaInicio:e.hora_inicio,horaFin:e.hora_fin,id:e.id,fecha:e.fecha})),console.log("Horarios seleccionados:",this.horarios)})}onHorarioSeleccionado(t){this.selectedTurno=t,console.log("Turno seleccionado:",this.selectedTurno),this.turnoForm.patchValue({horario:`${t.horaInicio} - ${t.horaFin}`})}solicitarTurno(){return d(this,null,function*(){if(!this.selectedTurno){L.default.fire("Error","Debe seleccionar un turno.","error");return}try{let t=yield this.getUser();console.log("datos del usuario",t.dni,t.obraSocial,t.nombre),this.obtenerIdPaciente=t.role==="paciente"?t.uid:this.usuarioSeleccionado.uid;let e=Oe(O({},this.turnoForm.value),{turnoId:this.selectedTurno.id,fecha:this.selectedTurno.fecha,horaInicio:this.selectedTurno.horaInicio,horaFin:this.selectedTurno.horaFin,especialidad:this.especialiadaSeleccionada,especialista:this.nombreEspecialista,paciente:this.isAdmin?this.turnoForm.value.paciente:t.nombre,dni:this.isAdmin?this.turnoForm.value.dni:t.dni,obraSocial:this.isAdmin?this.turnoForm.value.obraSocial:t.obraSocial});yield this.turnoService.buscarYActualizarTurno(e,this.obtenerIdPaciente),L.default.fire("Registro exitoso","El turno ha sido solicitado correctamente.","success"),this.router.navigate(["/bienvenida"])}catch(t){console.error("Error al solicitar el turno:",t),L.default.fire("Error","No se pudo solicitar el turno. Int\xE9ntalo nuevamente.","error")}})}static \u0275fac=function(e){return new(e||c)(x(Y),x(D),x(F),x(y),x($e),x(j))};static \u0275cmp=k({type:c,selectors:[["app-solicitar-turno"]],decls:20,vars:7,consts:[[3,"ngSubmit","formGroup"],["for","especialista"],[1,"profesionales-container"],["class","profesional",3,"click",4,"ngFor","ngForOf"],["for","especialidad"],[1,"especialidades-container"],["class","especialidad-btn",3,"click",4,"ngFor","ngForOf"],["for","horario"],[1,"dias-container"],[3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"usuarioSeleccionado",4,"ngIf"],["type","submit"],[1,"profesional",3,"click"],[1,"profesional-img",3,"src","alt"],[1,"profesional-nombre"],[1,"especialidad-btn",3,"click"],[1,"especialidad-img",3,"src","alt"],[1,"especialidad-nombre"],[3,"click"],["type","button",1,"dia-btn"],["type","button",1,"horario-btn"],["for","paciente"],["formControlName","paciente","type","text","readonly",""],["for","dni"],["formControlName","dni","type","text","readonly",""],["for","obraSocial"],["formControlName","obraSocial","type","text","readonly",""],[3,"usuarioSeleccionado"]],template:function(e,i){e&1&&(n(0,"form",0),h("ngSubmit",function(){return i.solicitarTurno()}),n(1,"label",1),r(2,"Especialista:"),o(),n(3,"div",2),S(4,Je,4,4,"div",3),o(),n(5,"label",4),r(6,"Especialidad:"),o(),n(7,"div",5),S(8,Ke,4,3,"div",6),o(),n(9,"label",7),r(10,"D\xEDa:"),o(),n(11,"div",8),S(12,Xe,4,4,"div",9),o(),n(13,"label",7),r(14,"Horario:"),o(),S(15,Ze,3,2,"div",9)(16,et,10,0,"div",10)(17,tt,1,0,"app-listado-paciente",11),n(18,"button",12),r(19,"Solicitar turno"),o()()),e&2&&(u("formGroup",i.turnoForm),l(4),u("ngForOf",i.especialistas),l(4),u("ngForOf",i.especialidadesDelEspecialista),l(4),u("ngForOf",i.diasDisponibles),l(3),u("ngForOf",i.horarios),l(),u("ngIf",i.isAdmin),l(),u("ngIf",i.isAdmin))},dependencies:[z,R,oe,te,ie,ne,Ne,ze,Ue,De],styles:["form[_ngcontent-%COMP%]{max-width:800px;margin:20px auto;padding:30px;border:2px solid #007bff;border-radius:15px;background-color:#e0f7fa;box-shadow:0 4px 20px #0003}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px;display:block;color:#007bff}input[type=text][_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #007bff;border-radius:6px;font-size:16px;margin-bottom:15px;background-color:#f1f1f1;transition:border-color .3s,background-color .3s}input[type=text][_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{border-color:#0056b3;background-color:#fff}button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 15px;border:none;border-radius:6px;cursor:pointer;width:100%;font-size:1em;transition:background-color .3s,transform .2s}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:translateY(-2px)}.profesionales-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:20px}.profesional[_ngcontent-%COMP%]{cursor:pointer;text-align:center;transition:transform .3s;border-radius:50%;padding:15px;background-color:#f1f1f1;box-shadow:0 4px 10px #0003}.profesional[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.profesional-img[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;object-fit:cover}.profesional-nombre[_ngcontent-%COMP%]{margin-top:5px;font-size:14px;font-weight:700;color:#007bff}.especialidades-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:20px}.especialidad-btn[_ngcontent-%COMP%]{cursor:pointer;text-align:center;border-radius:12px;padding:20px;background-color:#f1f1f1;box-shadow:0 4px 10px #0003;transition:transform .3s}.especialidad-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.especialidad-img[_ngcontent-%COMP%]{width:60px;height:60px;object-fit:cover;border-radius:8px}.especialidad-nombre[_ngcontent-%COMP%]{margin-top:5px;font-size:14px;font-weight:700;color:#007bff}.dias-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:20px}.dia-btn[_ngcontent-%COMP%]{cursor:pointer;text-align:center;border-radius:6px;padding:15px;background-color:#f1f1f1;box-shadow:0 4px 10px #0003;width:150px;transition:transform .3s}.dia-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.dia-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;font-weight:700;color:#007bff}.horarios-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px}.horario-btn[_ngcontent-%COMP%]{padding:12px;border-radius:8px;background-color:#4caf50;color:#fff;cursor:pointer;font-size:14px;text-align:center;min-width:80px;display:flex;justify-content:center;align-items:center}.horario-btn[_ngcontent-%COMP%]:hover{background-color:#45a049}div[ngIf][_ngcontent-%COMP%]{margin-bottom:20px;background-color:#f9f9f9;padding:15px;border-radius:8px;box-shadow:0 4px 10px #0000001a}input[readonly][_ngcontent-%COMP%]{background-color:#e0e0e0;cursor:not-allowed}"]})};var le=class c{constructor(t,e){this.authService=t;this.router=e}canActivate(t,e){return this.authService.getUser().pipe(q(i=>i&&(i.role==="administrador"||i.role==="paciente")?!0:(this.router.navigate(["/bienvenida"]),console.log("Acceso denegado: no es administrador ni paciente"),!1)))}static \u0275fac=function(e){return new(e||c)(I(y),I(j))};static \u0275prov=N({token:c,factory:c.\u0275fac,providedIn:"root"})};var T=Q(J());var de=class c{constructor(t){this.turnoService=t}usuarioSeleccionado=null;disponibilidadSemana={lunes:{horaInicio:"",horaFin:""},martes:{horaInicio:"",horaFin:""},mi\u00E9rcoles:{horaInicio:"",horaFin:""},jueves:{horaInicio:"",horaFin:""},viernes:{horaInicio:"",horaFin:""},s\u00E1bado:{horaInicio:"",horaFin:""},domingo:{horaInicio:"",horaFin:""}};horariosClinica={lunes:{apertura:"08:00",cierre:"19:00"},martes:{apertura:"08:00",cierre:"19:00"},mi\u00E9rcoles:{apertura:"08:00",cierre:"19:00"},jueves:{apertura:"08:00",cierre:"19:00"},viernes:{apertura:"08:00",cierre:"19:00"},s\u00E1bado:{apertura:"08:00",cierre:"14:00"},domingo:{apertura:null,cierre:null}};mostrarUsuario(t){this.usuarioSeleccionado=t}esHorarioValido(t){let e=parseInt(t.split(":")[1],10);return e===0||e===30}guardarDisponibilidad(){return d(this,null,function*(){if(!this.usuarioSeleccionado){T.default.fire("Error","Por favor, selecciona un especialista.","error");return}for(let t in this.disponibilidadSemana){let e=this.disponibilidadSemana[t],i=this.horariosClinica[t];if(e.horaInicio&&!this.esHorarioValido(e.horaInicio)||e.horaFin&&!this.esHorarioValido(e.horaFin)){T.default.fire("Error",`Los horarios de ${t} deben ser en intervalos de media hora (ej. 08:00 o 08:30).`,"error");return}if(i.apertura&&i.cierre){if(e.horaInicio<i.apertura||e.horaInicio>i.cierre||e.horaFin<i.apertura||e.horaFin>i.cierre){T.default.fire("Error",`El horario de ${t} debe estar entre ${i.apertura} y ${i.cierre}.`,"error");return}if(e.horaInicio>=e.horaFin){T.default.fire("Error",`En ${t}, la hora de inicio debe ser anterior a la hora de fin.`,"error");return}}else if(e.horaInicio||e.horaFin){T.default.fire("Error",`El d\xEDa ${t} est\xE1 cerrado, no debe haber horarios de disponibilidad.`,"error");return}}try{yield this.turnoService.guardarDisponibilidad(this.usuarioSeleccionado.uid,this.disponibilidadSemana),this.generarTurnosProximos15Dias(),T.default.fire("\xC9xito","Disponibilidad guardada correctamente.","success")}catch(t){console.error("Error al guardar la disponibilidad:",t),T.default.fire("Error","No se pudo guardar la disponibilidad.","error")}})}generarTurnosProximos15Dias(){return d(this,null,function*(){if(console.log("entramos a la creacion de turnos"),!this.usuarioSeleccionado){T.default.fire("Error","Por favor, selecciona un especialista.","error");return}let t=yield this.turnoService.obtenerDisponibilidad(this.usuarioSeleccionado.uid);if(!t){T.default.fire("Error","No se encontr\xF3 disponibilidad para el especialista seleccionado.","error");return}let e=[],i=new Date;for(let a=0;a<15;a++){let s=new Date(i);s.setDate(i.getDate()+a);let p=this.obtenerNombreDia(s);if(t[p]){let b=t[p];if(b.horaInicio&&b.horaFin){let V=b.horaInicio;for(;V<b.horaFin;){let w=this.sumarMinutos(V,30);w<=b.horaFin&&e.push({especialista_id:this.usuarioSeleccionado.uid,fecha:s.toISOString().split("T")[0],hora_inicio:V,hora_fin:w,estado:"disponible"}),V=w}}}}try{yield this.turnoService.guardarTurnos(e),T.default.fire("\xC9xito","Turnos generados para los pr\xF3ximos 15 d\xEDas.","success")}catch(a){console.error("Error al generar los turnos:",a),T.default.fire("Error","No se pudieron generar los turnos.","error")}})}obtenerNombreDia(t){return["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"][t.getDay()]}sumarMinutos(t,e){let[i,a]=t.split(":").map(Number),s=new Date;s.setHours(i,a+e);let p=String(s.getHours()).padStart(2,"0"),b=String(s.getMinutes()).padStart(2,"0");return`${p}:${b}`}static \u0275fac=function(e){return new(e||c)(x(F))};static \u0275cmp=k({type:c,selectors:[["app-gestion-horarios"]],decls:0,vars:0,template:function(e,i){},styles:['@charset "UTF-8";form[_ngcontent-%COMP%]{max-width:800px;margin:20px auto;padding:30px;border:2px solid #007bff;border-radius:15px;background-color:#e0f7fa;box-shadow:0 4px 20px #0003}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px;display:block;color:#007bff}.horarios[_ngcontent-%COMP%]{display:flex;gap:15px}input[type=time][_ngcontent-%COMP%]{width:48%;padding:12px;border:1px solid #007bff;border-radius:6px;font-size:16px;box-sizing:border-box;background-color:#f1f1f1;transition:border-color .3s,background-color .3s}input[type=time][_ngcontent-%COMP%]:focus{border-color:#0056b3;outline:none;background-color:#fff}button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 15px;border:none;border-radius:6px;cursor:pointer;transition:background-color .3s,transform .2s;width:100%;font-size:1em}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:translateY(-2px)}div[_ngcontent-%COMP%]{margin-bottom:20px}']})};var U=Q(J());function it(c,t){if(c&1){let e=E();n(0,"div")(1,"input",1),h("change",function(a){v(e);let s=m();return _(s.onEspecialidadChange(a))}),o(),r(2),o()}if(c&2){let e=t.$implicit;l(),u("value",e.nombre),l(),G(" ",e.nombre,`
`)}}function nt(c,t){if(c&1){let e=E();n(0,"div")(1,"input",2),h("change",function(a){let s=v(e).$implicit,p=m();return _(p.onEspecialistaChange(a,s))}),o(),r(2),o()}if(c&2){let e=t.$implicit;l(),u("value",e.uid),l(),M(" ",e.nombre," ",e.apellido,`
`)}}function ot(c,t){if(c&1){let e=E();n(0,"button",5),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.cancelarTurno(a))}),r(1," Cancelar Turno "),o()}}function at(c,t){c&1&&(n(0,"button",6),r(1," no acciones "),o())}function rt(c,t){if(c&1&&(n(0,"tr")(1,"td"),r(2),o(),n(3,"td"),r(4),o(),n(5,"td"),r(6),o(),n(7,"td"),r(8),o(),n(9,"td"),r(10),o(),n(11,"td"),r(12),o(),n(13,"td"),r(14),o(),n(15,"td"),r(16),o(),n(17,"td"),S(18,ot,2,0,"button",3)(19,at,2,0,"button",4),o()()),c&2){let e=t.$implicit,i=m();l(2),f(e.dni),l(2),f(e.paciente),l(2),f(e.obraSocial),l(2),f(i.nombreEspecialista),l(2),f(e.especialidad),l(2),f(e.fecha),l(2),M("",e.hora_inicio," - ",e.hora_fin,""),l(2),f(e.estado),l(2),u("ngIf",e.estado==="solicitado"),l(),u("ngIf",e.estado!=="solicitado")}}var pe=class c{constructor(t,e,i){this.turnoService=t;this.especialidadService=e;this.especialistaService=i}especialidades=[];especialistas=[];horarios=[];nombreEspecialista;especialidadSeleccionada="";ngOnInit(){this.cargarEspecialidades()}cargarEspecialidades(){return d(this,null,function*(){this.especialidades=yield this.especialidadService.getEspecialidades()})}onEspecialidadChange(t){return d(this,null,function*(){let e=t.target;if(this.especialidadSeleccionada=e.value,this.especialidadSeleccionada)try{this.especialistas=yield this.especialistaService.getEspecialistasPorEspecialidad(this.especialidadSeleccionada),this.horarios=[]}catch{U.default.fire("Error","No se pudieron cargar los especialistas","error")}else this.especialistas=[],this.horarios=[]})}onEspecialistaChange(t,e){return d(this,null,function*(){let a=t.target.value;if(a){this.nombreEspecialista=`${e.nombre} ${e.apellido}`;try{let s=yield this.turnoService.obtenerTurnosDisponiblesEspecialista(a);this.horarios=s.filter(p=>p.especialidad===this.especialidadSeleccionada),this.horarios.sort((p,b)=>new Date(p.fecha).getTime()-new Date(b.fecha).getTime())}catch{U.default.fire("Error","No se pudieron cargar los turnos","error")}}else this.horarios=[]})}cancelarTurno(t){return d(this,null,function*(){if(["Aceptado","Realizado","Rechazado"].includes(t.estado)){U.default.fire("Aviso","No se puede cancelar un turno aceptado, realizado o rechazado","info");return}let{isConfirmed:e,value:i}=yield U.default.fire({title:"\xBFEst\xE1s seguro de cancelar el turno?",text:"Por favor, ingresa el motivo de la cancelaci\xF3n",input:"textarea",inputPlaceholder:"Escribe aqu\xED el motivo...",inputAttributes:{"aria-label":"Motivo de cancelaci\xF3n"},confirmButtonText:"Cancelar turno",showCancelButton:!0,cancelButtonText:"Volver",inputValidator:a=>a?null:"El motivo es requerido para cancelar el turno"});if(e&&i)try{yield this.turnoService.cancelarTurno(t.id,i),U.default.fire("Cancelado","El turno ha sido cancelado con \xE9xito","success"),yield this.onEspecialistaChange({target:{value:t.especialistaId}},{nombre:t.nombreEspecialista,apellido:t.apellidoEspecialista})}catch{U.default.fire("Error","No se pudo cancelar el turno","error")}})}static \u0275fac=function(e){return new(e||c)(x(F),x(Y),x(D))};static \u0275cmp=k({type:c,selectors:[["app-gestionar-turnos"]],decls:31,vars:3,consts:[[4,"ngFor","ngForOf"],["type","radio","name","especialidad",3,"change","value"],["type","radio","name","especialista",3,"change","value"],["class","cancelar",3,"click",4,"ngIf"],["class","no-accion","disabled","",4,"ngIf"],[1,"cancelar",3,"click"],["disabled","",1,"no-accion"]],template:function(e,i){e&1&&(n(0,"h2"),r(1,"Listado de Turnos"),o(),n(2,"label"),r(3,"Especialidad:"),o(),S(4,it,3,2,"div",0),n(5,"label"),r(6,"Especialista:"),o(),S(7,nt,3,3,"div",0),n(8,"table")(9,"thead")(10,"tr")(11,"th"),r(12,"DNI"),o(),n(13,"th"),r(14,"Paciente"),o(),n(15,"th"),r(16,"Obra Social"),o(),n(17,"th"),r(18,"Especialista"),o(),n(19,"th"),r(20,"Especialidad"),o(),n(21,"th"),r(22,"Fecha"),o(),n(23,"th"),r(24,"Horario"),o(),n(25,"th"),r(26,"Estado"),o(),n(27,"th"),r(28,"Acciones"),o()()(),n(29,"tbody"),S(30,rt,20,11,"tr",0),o()()),e&2&&(l(4),u("ngForOf",i.especialidades),l(3),u("ngForOf",i.especialistas),l(23),u("ngForOf",i.horarios))},dependencies:[z,R],styles:['@charset "UTF-8";h2[_ngcontent-%COMP%]{color:#154360;text-align:center;margin-bottom:1rem;font-weight:700;font-size:1.5rem}label[_ngcontent-%COMP%]{font-weight:700;color:#154360;margin-right:.5rem}select[_ngcontent-%COMP%]{padding:.5rem;border-radius:4px;border:1px solid #D5D8DC;margin-bottom:1rem;margin-right:1rem;outline:none;transition:border-color .3s ease}select[_ngcontent-%COMP%]:focus{border-color:#154360}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;box-shadow:0 4px 8px #0000001a;margin:0 auto;border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left}thead[_ngcontent-%COMP%]{background-color:#154360;color:#fff}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700;text-transform:uppercase;letter-spacing:.05em}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s ease,transform .2s ease}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f3f4}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#d5e8e8;transform:scale(1.01)}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #F2F3F4}button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.9rem;border:none;border-radius:4px;color:#fff;cursor:pointer;transition:background-color .3s ease,transform .2s ease;width:100%}button.no-accion[_ngcontent-%COMP%]{background-color:#b0e915}button.cancelar[_ngcontent-%COMP%]{background-color:#c0392b}button.cancelar[_ngcontent-%COMP%]:hover{background-color:#a93226;transform:scale(1.05)}td.estado[_ngcontent-%COMP%]{font-weight:700;color:#1e8449}td.estado.inhabilitado[_ngcontent-%COMP%]{color:#c0392b}']})};var g=Q(J());function st(c,t){if(c&1){let e=E();n(0,"div")(1,"input",1),h("change",function(a){v(e);let s=m();return _(s.onEspecialidadChange(a))}),o(),r(2),o()}if(c&2){let e=t.$implicit;l(),u("value",e),l(),G(" ",e,`
`)}}function ct(c,t){if(c&1){let e=E();n(0,"div")(1,"input",2),h("change",function(a){let s=v(e).$implicit,p=m();return _(p.onPacienteChange(a,s))}),o(),r(2),o()}if(c&2){let e=t.$implicit;l(),u("value",e.uid),l(),M(" ",e.nombre," ",e.apellido,`
`)}}function lt(c,t){if(c&1){let e=E();n(0,"button",7),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.cancelarTurno(a))}),r(1," Cancelar Turno "),o()}}function dt(c,t){if(c&1){let e=E();n(0,"button",8),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.aceptarTurno(a))}),r(1," aceptar turno "),o()}}function pt(c,t){if(c&1){let e=E();n(0,"button",9),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.finalizarTurno(a))}),r(1," finalizar turno "),o()}}function ut(c,t){if(c&1){let e=E();n(0,"button",10),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.verResenaTurno(a))}),r(1," ver rese\xF1a "),o()}}function mt(c,t){if(c&1&&(n(0,"tr")(1,"td"),r(2),o(),n(3,"td"),r(4),o(),n(5,"td"),r(6),o(),n(7,"td"),r(8),o(),n(9,"td"),r(10),o(),n(11,"td"),r(12),o(),n(13,"td"),r(14),o(),n(15,"td"),r(16),o(),n(17,"td"),S(18,lt,2,0,"button",3)(19,dt,2,0,"button",4)(20,pt,2,0,"button",5)(21,ut,2,0,"button",6),o()()),c&2){let e=t.$implicit,i=m();l(2),f(e.dni),l(2),f(i.nombrePaciente),l(2),f(e.obraSocial),l(2),f(e.especialista),l(2),f(i.especialidadSeleccionada),l(2),f(e.fecha),l(2),M("",e.hora_inicio," - ",e.hora_fin,""),l(2),f(e.estado),l(2),u("ngIf",e.estado==="solicitado"),l(),u("ngIf",e.estado==="solicitado"),l(),u("ngIf",e.estado==="aceptado"),l(),u("ngIf",e.estado==="realizado")}}var ue=class c{constructor(t,e,i){this.turnoService=t;this.especialistaService=e;this.authenticationService=i}especialidades=[];pacientes=[];horarios=[];nombrePaciente="";especialidadSeleccionada="";especialistaIniciado;pacienteSeleccionadoId="";ngOnInit(){this.authenticationService.getUser().subscribe(t=>{t?(this.especialistaIniciado=t,this.cargarPacientes(t.uid),this.cargarEspecialidades()):g.default.fire("Error","No se encontr\xF3 el usuario","error")})}cargarPacientes(t){return d(this,null,function*(){try{this.pacientes=yield this.especialistaService.getPacientesUnicosPorEspecialista(t),console.log("Pacientes cargados:",this.pacientes)}catch(e){console.error("Error cargando pacientes:",e),g.default.fire("Error","No se pudieron cargar los pacientes","error")}})}cargarEspecialidades(){return d(this,null,function*(){this.especialistaIniciado&&this.especialistaIniciado.especialidades?(this.especialidades=this.especialistaIniciado.especialidades,console.log("Especialidades cargadas:",this.especialidades)):(this.especialidades=[],g.default.fire("Error","No se encontraron especialidades para este especialista","error"))})}onEspecialidadChange(t){return d(this,null,function*(){let e=t.target;if(this.especialidadSeleccionada=e.value,this.especialidadSeleccionada)try{this.pacientes=yield this.especialistaService.getPacientesUnicosPorEspecialidad(this.especialistaIniciado.uid,this.especialidadSeleccionada),this.horarios=[]}catch{g.default.fire("Error","No se pudieron cargar los pacientes","error")}else this.pacientes=[],this.horarios=[]})}onPacienteChange(t,e){return d(this,null,function*(){let i=t.target;if(this.pacienteSeleccionadoId=i.value,this.pacienteSeleccionadoId){this.nombrePaciente=`${e.nombre} ${e.apellido}`;try{let a=yield this.turnoService.obtenerTurnosDisponiblesPaciente(this.pacienteSeleccionadoId);this.horarios=a.filter(s=>s.especialidad===this.especialidadSeleccionada),this.horarios.sort((s,p)=>new Date(s.fecha).getTime()-new Date(p.fecha).getTime())}catch{g.default.fire("Error","No se pudieron cargar los turnos","error")}}else this.horarios=[]})}cancelarTurno(t){return d(this,null,function*(){if(["Aceptado","Realizado","Rechazado"].includes(t.estado)){g.default.fire("Aviso","No se puede cancelar un turno aceptado, realizado o rechazado","info");return}let{isConfirmed:e,value:i}=yield g.default.fire({title:"\xBFEst\xE1s seguro de cancelar el turno?",text:"Por favor, ingresa el motivo de la cancelaci\xF3n",input:"textarea",inputPlaceholder:"Escribe aqu\xED el motivo...",inputAttributes:{"aria-label":"Motivo de cancelaci\xF3n"},confirmButtonText:"Cancelar turno",showCancelButton:!0,cancelButtonText:"Volver",inputValidator:a=>a?null:"El motivo es requerido para cancelar el turno"});if(e&&i)try{yield this.turnoService.cancelarTurno(t.id,i),g.default.fire("Cancelado","El turno ha sido cancelado con \xE9xito","success"),this.onPacienteChange({target:{value:this.pacienteSeleccionadoId}},{nombre:this.nombrePaciente})}catch{g.default.fire("Error","No se pudo cancelar el turno","error")}})}aceptarTurno(t){return d(this,null,function*(){if(["Aceptado","Realizado","Rechazado"].includes(t.estado)){g.default.fire("Aviso","No se puede cancelar un turno aceptado, realizado o rechazado","info");return}let{isConfirmed:e}=yield g.default.fire({title:"\xBFEst\xE1s seguro de aceptar el turno?",confirmButtonText:"aceptar turno",showCancelButton:!0,cancelButtonText:"Volver"});if(e)try{yield this.turnoService.aceptarTurno(t.id),g.default.fire("aceptado","El turno ha sido aceptado con \xE9xito","success")}catch{g.default.fire("Error","No se pudo aceptar el turno","error")}})}finalizarTurno(t){return d(this,null,function*(){if(t.estado!=="aceptado"){g.default.fire("Aviso","Solo puedes finalizar un turno aceptado","info");return}let{isConfirmed:e,value:i}=yield g.default.fire({title:"Finalizar Turno y Registrar Historia Cl\xEDnica",html:`
        <label for="diagnostico">Diagn\xF3stico:</label>
        <textarea id="diagnostico" rows="2" style="width: 100%;" placeholder="Escribe aqu\xED el diagn\xF3stico..."></textarea>
        
        <label for="rese\xF1a">Rese\xF1a:</label>
        <textarea id="rese\xF1a" rows="2" style="width: 100%;" placeholder="Escribe aqu\xED la rese\xF1a..."></textarea>
        
        <label for="altura">Altura (cm):</label>
        <input type="number" id="altura" style="width: 100%;" placeholder="Altura en cm" />
        
        <label for="peso">Peso (kg):</label>
        <input type="number" id="peso" style="width: 100%;" placeholder="Peso en kg" />
        
        <label for="temperatura">Temperatura (\xB0C):</label>
        <input type="number" id="temperatura" style="width: 100%;" placeholder="Temperatura en \xB0C" />
        
        <label for="presion">Presi\xF3n:</label>
        <input type="text" id="presion" style="width: 100%;" placeholder="Ej. 120/80" />
        
        <label>Datos Din\xE1micos:</label>
        <div id="datosDinamicos">
          <input type="text" placeholder="Clave" style="width: 48%; display: inline-block;" id="clave1" />
          <input type="text" placeholder="Valor" style="width: 48%; display: inline-block;" id="valor1" />
          <br />
          <input type="text" placeholder="Clave" style="width: 48%; display: inline-block;" id="clave2" />
          <input type="text" placeholder="Valor" style="width: 48%; display: inline-block;" id="valor2" />
          <br />
          <input type="text" placeholder="Clave" style="width: 48%; display: inline-block;" id="clave3" />
          <input type="text" placeholder="Valor" style="width: 48%; display: inline-block;" id="valor3" />
        </div>
      `,focusConfirm:!1,preConfirm:()=>({diagnostico:document.getElementById("diagnostico").value,rese\u00F1a:document.getElementById("rese\xF1a").value,historiaClinica:{altura:+document.getElementById("altura").value,peso:+document.getElementById("peso").value,temperatura:+document.getElementById("temperatura").value,presion:document.getElementById("presion").value,datosDinamicos:[{clave:document.getElementById("clave1").value,valor:document.getElementById("valor1").value},{clave:document.getElementById("clave2").value,valor:document.getElementById("valor2").value},{clave:document.getElementById("clave3").value,valor:document.getElementById("valor3").value}].filter(a=>a.clave&&a.valor)}}),confirmButtonText:"Finalizar Turno",showCancelButton:!0,cancelButtonText:"Cancelar"});if(e){let{diagnostico:a,rese\u00F1a:s,historiaClinica:p}=i;if(!a||!s||!p.altura||!p.peso||!p.temperatura||!p.presion){g.default.fire("Error","Todos los campos son obligatorios","error");return}if(p.temperatura<30||p.temperatura>45){g.default.fire("Error","La temperatura debe estar entre 30\xB0C y 45\xB0C","error");return}if(p.altura<30||p.altura>250){g.default.fire("Error","La altura debe estar entre 30 cm y 250 cm","error");return}if(p.peso<3||p.peso>500){g.default.fire("Error","El peso debe estar entre 3 kg y 500 kg","error");return}try{yield this.turnoService.finalizarTurno(t.id,{diagnostico:a,rese\u00F1a:s}),yield this.turnoService.finalizarTurnoHistoriaClinica(t,{historiaClinica:p}),g.default.fire("Finalizado","El turno ha sido finalizado con \xE9xito","success"),this.onPacienteChange({target:{value:this.pacienteSeleccionadoId}},{nombre:this.nombrePaciente})}catch{g.default.fire("Error","No se pudo finalizar el turno","error")}}})}verResenaTurno(t){return d(this,null,function*(){if(t.estado!=="realizado"){g.default.fire("Aviso","Solo puedes ver la rese\xF1a de un turno realizado","info");return}try{yield this.turnoService.obtenerRese\u00F1aTurno(t.id)}catch(e){console.error("Error al obtener rese\xF1a:",e),g.default.fire("Error","No se pudo obtener la rese\xF1a","error")}})}static \u0275fac=function(e){return new(e||c)(x(F),x(D),x(y))};static \u0275cmp=k({type:c,selectors:[["app-turnos-especialista"]],decls:31,vars:3,consts:[[4,"ngFor","ngForOf"],["type","radio","name","especialidad",3,"change","value"],["type","radio","name","paciente",3,"change","value"],["class","cancelar",3,"click",4,"ngIf"],["class","aceptar",3,"click",4,"ngIf"],["class","finalizar",3,"click",4,"ngIf"],["class","realizado",3,"click",4,"ngIf"],[1,"cancelar",3,"click"],[1,"aceptar",3,"click"],[1,"finalizar",3,"click"],[1,"realizado",3,"click"]],template:function(e,i){e&1&&(n(0,"h2"),r(1,"Listado de Turnos"),o(),n(2,"label"),r(3,"Especialidad:"),o(),S(4,st,3,2,"div",0),n(5,"label"),r(6,"Pacientes:"),o(),S(7,ct,3,3,"div",0),n(8,"table")(9,"thead")(10,"tr")(11,"th"),r(12,"DNI"),o(),n(13,"th"),r(14,"Paciente"),o(),n(15,"th"),r(16,"Obra Social"),o(),n(17,"th"),r(18,"Especialista"),o(),n(19,"th"),r(20,"Especialidad"),o(),n(21,"th"),r(22,"Fecha"),o(),n(23,"th"),r(24,"Horario"),o(),n(25,"th"),r(26,"Estado"),o(),n(27,"th"),r(28,"Acciones"),o()()(),n(29,"tbody"),S(30,mt,22,13,"tr",0),o()()),e&2&&(l(4),u("ngForOf",i.especialidades),l(3),u("ngForOf",i.pacientes),l(23),u("ngForOf",i.horarios))},dependencies:[z,R],styles:['@charset "UTF-8";h2[_ngcontent-%COMP%]{color:#154360;text-align:center;margin-bottom:1rem;font-weight:700;font-size:1.5rem}label[_ngcontent-%COMP%]{font-weight:700;color:#154360;margin-right:.5rem}select[_ngcontent-%COMP%]{padding:.5rem;border-radius:4px;border:1px solid #D5D8DC;margin-bottom:1rem;margin-right:1rem;outline:none;transition:border-color .3s ease}select[_ngcontent-%COMP%]:focus{border-color:#154360}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;box-shadow:0 4px 8px #0000001a;margin:0 auto;border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left}thead[_ngcontent-%COMP%]{background-color:#154360;color:#fff}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700;text-transform:uppercase;letter-spacing:.05em}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s ease,transform .2s ease}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f3f4}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#d5e8e8;transform:scale(1.01)}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #F2F3F4}button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.9rem;border:none;border-radius:4px;color:#fff;cursor:pointer;transition:background-color .3s ease,transform .2s ease;width:100%}button.aceptar[_ngcontent-%COMP%], button.finalizar[_ngcontent-%COMP%], button.realizado[_ngcontent-%COMP%]{background-color:#b0e915}button.aceptar[_ngcontent-%COMP%]:hover, button.finalizar[_ngcontent-%COMP%]:hover, button.realizado[_ngcontent-%COMP%]:hover{background-color:#82b825;transform:scale(1.05)}button.cancelar[_ngcontent-%COMP%]{background-color:#c0392b}button.cancelar[_ngcontent-%COMP%]:hover{background-color:#a93226;transform:scale(1.05)}td.estado[_ngcontent-%COMP%]{font-weight:700;color:#1e8449}td.estado.inhabilitado[_ngcontent-%COMP%]{color:#c0392b}']})};var me=class c{constructor(t,e){this.authService=t;this.router=e}canActivate(t,e){return this.authService.getUser().pipe(q(i=>i&&i.role==="especialista"?!0:(this.router.navigate(["/bienvenida"]),console.log("no es especialista verifica las cosas bien"),!1)))}static \u0275fac=function(e){return new(e||c)(I(y),I(j))};static \u0275prov=N({token:c,factory:c.\u0275fac,providedIn:"root"})};var C=Q(J());function ft(c,t){if(c&1){let e=E();n(0,"button",22),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.cancelarTurno(a))}),r(1," Cancelar Turno "),o()}}function ht(c,t){if(c&1){let e=E();n(0,"button",23),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.verResenaTurno(a))}),r(1," ver rese\xF1a "),o()}}function gt(c,t){if(c&1){let e=E();n(0,"button",24),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.mostrarEncuesta(a))}),r(1),o()}if(c&2){let e=m().$implicit;u("disabled",e.encuesta),l(),G(" ",e.encuesta?"Encuesta Realizada":"Realizar Encuesta"," ")}}function bt(c,t){if(c&1){let e=E();n(0,"button",25),h("click",function(){v(e);let a=m().$implicit,s=m();return _(s.calificarAtencion(a))}),r(1),o()}if(c&2){let e=m().$implicit;u("disabled",e.calificacionTurno),l(),G(" ",e.calificacionTurno?"Calificaci\xF3n Realizada":"Calificar Atenci\xF3n"," ")}}function vt(c,t){if(c&1&&(n(0,"tr")(1,"td"),r(2),o(),n(3,"td"),r(4),o(),n(5,"td"),r(6),o(),n(7,"td"),r(8),o(),n(9,"td"),r(10),o(),n(11,"td"),r(12),o(),n(13,"td"),r(14),o(),n(15,"td"),r(16),o(),n(17,"td"),S(18,ft,2,0,"button",18)(19,ht,2,0,"button",19)(20,gt,2,2,"button",20)(21,bt,2,2,"button",21),o()()),c&2){let e=t.$implicit;l(2),f(e.dni),l(2),f(e.paciente),l(2),f(e.obraSocial),l(2),f(e.especialista),l(2),f(e.especialidad),l(2),f(e.fecha),l(2),M("",e.hora_inicio," - ",e.hora_fin,""),l(2),f(e.estado),l(2),u("ngIf",e.estado==="solicitado"),l(),u("ngIf",e.estado==="realizado"),l(),u("ngIf",e.estado==="realizado"),l(),u("ngIf",e.estado==="realizado")}}var fe=class c{constructor(t,e,i,a){this.turnoService=t;this.especialidadService=e;this.especialistaService=i;this.authenticationService=a}especialidades=[];especialistas=[];horarios=[];nombreEspecialista;especialidadSeleccionada="";encuesta={};filtroCampo="";filtroValor="";pacienteActual="";ngOnInit(){this.cargarEspecialidades(),this.authenticationService.getUser().subscribe(t=>{t?this.pacienteActual=t:C.default.fire("Error","No se encontr\xF3 el usuario","error")})}cargarEspecialidades(){return d(this,null,function*(){this.especialidades=yield this.especialidadService.getEspecialidades()})}onEspecialidadChange(t){return d(this,null,function*(){let e=t.target;if(this.especialidadSeleccionada=e.value,this.especialidadSeleccionada)try{this.especialistas=yield this.especialistaService.getEspecialistasPorEspecialidad(this.especialidadSeleccionada),this.horarios=[]}catch{C.default.fire("Error","No se pudieron cargar los especialistas","error")}else this.especialistas=[],this.horarios=[]})}onEspecialistaChange(t,e){return d(this,null,function*(){let a=t.target.value;if(a){this.nombreEspecialista=`${e.nombre} ${e.apellido}`;try{let s=yield this.turnoService.obtenerTurnosDisponiblesPacienteEspecialista(this.pacienteActual.uid,a);this.horarios=s.filter(p=>p.especialidad===this.especialidadSeleccionada),this.horarios.sort((p,b)=>new Date(p.fecha).getTime()-new Date(b.fecha).getTime())}catch{C.default.fire("Error","No se pudieron cargar los turnos","error")}}else this.horarios=[]})}cancelarTurno(t){return d(this,null,function*(){if(["Aceptado","Realizado","Rechazado"].includes(t.estado)){C.default.fire("Aviso","No se puede cancelar un turno aceptado, realizado o rechazado","info");return}let{isConfirmed:e,value:i}=yield C.default.fire({title:"\xBFEst\xE1s seguro de cancelar el turno?",text:"Por favor, ingresa el motivo de la cancelaci\xF3n",input:"textarea",inputPlaceholder:"Escribe aqu\xED el motivo...",inputAttributes:{"aria-label":"Motivo de cancelaci\xF3n"},confirmButtonText:"Cancelar turno",showCancelButton:!0,cancelButtonText:"Volver",inputValidator:a=>a?null:"El motivo es requerido para cancelar el turno"});if(e&&i)try{yield this.turnoService.cancelarTurno(t.id,i),C.default.fire("Cancelado","El turno ha sido cancelado con \xE9xito","success"),yield this.onEspecialistaChange({target:{value:t.especialistaId}},{nombre:t.nombreEspecialista,apellido:t.apellidoEspecialista})}catch{C.default.fire("Error","No se pudo cancelar el turno","error")}})}verResenaTurno(t){return d(this,null,function*(){if(t.estado!=="realizado"){C.default.fire("Aviso","Solo puedes ver la rese\xF1a de un turno realizado","info");return}try{yield this.turnoService.obtenerRese\u00F1aTurno(t.id)}catch(e){console.error("Error al obtener rese\xF1a:",e),C.default.fire("Error","No se pudo obtener la rese\xF1a","error")}})}mostrarEncuesta(t){return d(this,null,function*(){C.default.fire({title:"Completar Encuesta",html:`
        <label for="pregunta1">\xBFC\xF3mo calificar\xEDas la atenci\xF3n del especialista?</label>
        <input type="text" id="pregunta1" class="swal2-input" placeholder="Tu respuesta aqu\xED">
        
        <label for="pregunta2">\xBFEst\xE1s satisfecho con la duraci\xF3n de tu consulta?</label>
        <input type="text" id="pregunta2" class="swal2-input" placeholder="Tu respuesta aqu\xED">
      `,focusConfirm:!1,preConfirm:()=>{let e=document.getElementById("pregunta1").value,i=document.getElementById("pregunta2").value;return(!e||!i)&&C.default.showValidationMessage("Por favor completa todas las preguntas"),{pregunta1:e,pregunta2:i}}}).then(e=>d(this,null,function*(){e.isConfirmed&&(this.encuesta={respuesta1:e.value.pregunta1,respuesta2:e.value.pregunta2},yield this.turnoService.guardarEncuesta(t.id,this.encuesta),C.default.fire("Gracias","Tus respuestas han sido guardadas","success"),yield this.onEspecialistaChange({target:{value:t.especialistaId}},{nombre:t.nombreEspecialista,apellido:t.apellidoEspecialista}))}))})}calificarAtencion(t){return d(this,null,function*(){if(t.estado!=="realizado"){C.default.fire("Aviso","Solo puedes calificar la atenci\xF3n de un turno realizado","info");return}let{value:e}=yield C.default.fire({title:"Calificar Atenci\xF3n",input:"textarea",inputPlaceholder:"Escribe aqu\xED tu comentario sobre la atenci\xF3n...",showCancelButton:!0,confirmButtonText:"Enviar Comentario",cancelButtonText:"Cancelar",inputValidator:i=>i?null:"El comentario es obligatorio"});e&&(yield this.turnoService.guardarCalificacion(t.id,e),C.default.fire("Gracias","Tu calificaci\xF3n ha sido guardada","success"),yield this.onEspecialistaChange({target:{value:t.especialistaId}},{nombre:t.nombreEspecialista,apellido:t.apellidoEspecialista}))})}buscarTurnos(){return d(this,null,function*(){if(!this.filtroCampo||!this.filtroValor){C.default.fire("Error","Por favor, complete ambos campos de filtro.","error");return}try{let t;["temperatura","altura","peso","presion"].includes(this.filtroCampo)?(console.log("entro a la clinica"),t=yield this.turnoService.filtrarTurnosPorCampoClinica(this.pacienteActual.uid,this.filtroCampo,this.filtroValor)):t=yield this.turnoService.filtrarTurnosPorCampoTurnos(this.pacienteActual.uid,this.filtroCampo,this.filtroValor),console.log("nunca entro a la clinica"),this.horarios=Object.values(t)}catch(t){console.error("Error al buscar turnos:",t),C.default.fire("Error","No se pudieron cargar los turnos","error")}})}static \u0275fac=function(e){return new(e||c)(x(F),x(Y),x(D),x(y))};static \u0275cmp=k({type:c,selectors:[["app-turnos-pacientes"]],decls:56,vars:3,consts:[[3,"ngSubmit"],["for","campo"],["id","campo","name","campo",3,"ngModelChange","ngModel"],["value","dni"],["value","paciente"],["value","obraSocial"],["value","especialidad"],["value","especialista"],["value","fecha"],["value","estado"],["value","temperatura"],["value","altura"],["value","peso"],["value","presion"],["for","valor"],["type","text","id","valor","name","valor",3,"ngModelChange","ngModel"],["type","submit"],[4,"ngFor","ngForOf"],["class","cancelar",3,"click",4,"ngIf"],["class","realizado",3,"click",4,"ngIf"],["class","encuesta",3,"disabled","click",4,"ngIf"],["class","calificacion",3,"disabled","click",4,"ngIf"],[1,"cancelar",3,"click"],[1,"realizado",3,"click"],[1,"encuesta",3,"click","disabled"],[1,"calificacion",3,"click","disabled"]],template:function(e,i){e&1&&(n(0,"h2"),r(1,"Listado de Turnos"),o(),n(2,"form",0),h("ngSubmit",function(){return i.buscarTurnos()}),n(3,"label",1),r(4,"Filtrar por:"),o(),n(5,"select",2),Ee("ngModelChange",function(s){return xe(i.filtroCampo,s)||(i.filtroCampo=s),s}),n(6,"option",3),r(7,"DNI"),o(),n(8,"option",4),r(9,"Paciente"),o(),n(10,"option",5),r(11,"Obra Social"),o(),n(12,"option",6),r(13,"Especialidad"),o(),n(14,"option",7),r(15,"Especialista"),o(),n(16,"option",8),r(17,"Fecha"),o(),n(18,"option",9),r(19,"Estado"),o(),n(20,"option",10),r(21,"temperatura"),o(),n(22,"option",11),r(23,"altura"),o(),n(24,"option",12),r(25,"Peso"),o(),n(26,"option",13),r(27,"presion"),o()(),n(28,"label",14),r(29,"Valor:"),o(),n(30,"input",15),Ee("ngModelChange",function(s){return xe(i.filtroValor,s)||(i.filtroValor=s),s}),o(),n(31,"button",16),r(32,"Buscar"),o()(),n(33,"table")(34,"thead")(35,"tr")(36,"th"),r(37,"DNI"),o(),n(38,"th"),r(39,"Paciente"),o(),n(40,"th"),r(41,"Obra Social"),o(),n(42,"th"),r(43,"Especialista"),o(),n(44,"th"),r(45,"Especialidad"),o(),n(46,"th"),r(47,"Fecha"),o(),n(48,"th"),r(49,"Horario"),o(),n(50,"th"),r(51,"Estado"),o(),n(52,"th"),r(53,"Acciones"),o()()(),n(54,"tbody"),S(55,vt,22,13,"tr",17),o()()),e&2&&(l(5),_e("ngModel",i.filtroCampo),l(25),_e("ngModel",i.filtroValor),l(25),u("ngForOf",i.horarios))},dependencies:[z,R,oe,je,He,te,Re,ie,ne,Ve,Ae],styles:['@charset "UTF-8";h2[_ngcontent-%COMP%]{color:#154360;text-align:center;margin-bottom:1rem;font-weight:700;font-size:1.5rem}label[_ngcontent-%COMP%]{font-weight:700;color:#154360;margin-right:.5rem}select[_ngcontent-%COMP%]{padding:.5rem;border-radius:4px;border:1px solid #D5D8DC;margin-bottom:1rem;margin-right:1rem;outline:none;transition:border-color .3s ease}select[_ngcontent-%COMP%]:focus{border-color:#154360}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;box-shadow:0 4px 8px #0000001a;margin:0 auto;border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left}thead[_ngcontent-%COMP%]{background-color:#154360;color:#fff}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700;text-transform:uppercase;letter-spacing:.05em}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s ease,transform .2s ease}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f3f4}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#d5e8e8;transform:scale(1.01)}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #F2F3F4}button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.9rem;border:none;border-radius:4px;color:#fff;cursor:pointer;transition:background-color .3s ease,transform .2s ease;width:100%}button.realizado[_ngcontent-%COMP%], button.encuesta[_ngcontent-%COMP%], button.calificacion[_ngcontent-%COMP%]{margin-bottom:3px;background-color:#b0e915}button.realizado[_ngcontent-%COMP%]:hover, button.encuesta[_ngcontent-%COMP%]:hover, button.calificacion[_ngcontent-%COMP%]:hover{background-color:#82b825;transform:scale(1.05)}button.cancelar[_ngcontent-%COMP%]{background-color:#c0392b}button.cancelar[_ngcontent-%COMP%]:hover{background-color:#a93226;transform:scale(1.05)}td.estado[_ngcontent-%COMP%]{font-weight:700;color:#1e8449}td.estado.inhabilitado[_ngcontent-%COMP%]{color:#c0392b}']})};var he=class c{constructor(t,e){this.authService=t;this.router=e}canActivate(t,e){return this.authService.getUser().pipe(q(i=>i&&i.role==="paciente"?!0:(this.router.navigate(["/bienvenida"]),console.log("no es paciente verifica las cosas bien"),!1)))}static \u0275fac=function(e){return new(e||c)(I(y),I(j))};static \u0275prov=N({token:c,factory:c.\u0275fac,providedIn:"root"})};var _t=[{path:"solicitar-turno",component:re,canActivate:[le]},{path:"gestionar-horarios",component:de,canActivate:[we]},{path:"gestionar-turnos",component:pe,canActivate:[we]},{path:"turnos-especialista",component:ue,canActivate:[me]},{path:"turnos-pacientes",component:fe,canActivate:[he]}],ge=class c{static \u0275fac=function(e){return new(e||c)};static \u0275mod=ee({type:c});static \u0275inj=Z({imports:[Ce.forChild(_t),Ce]})};var Ye=class c{static \u0275fac=function(e){return new(e||c)};static \u0275mod=ee({type:c});static \u0275inj=Z({imports:[Se,ge,Ge,qe,Se,Be]})};export{Ye as SeccionTurnosModule};
