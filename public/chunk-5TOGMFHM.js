import{a as U}from"./chunk-XXVAKMD5.js";import{a as z,c as J,d as K,g as Q,i as X,j as Y,k as Z,l as ee,m as te,o as ie,q as oe,r as se,s as re}from"./chunk-ID6MRWOA.js";import{A as v,Aa as q,E as T,G as p,I as s,J as c,K as F,M as w,O as l,P as O,R as $,a as u,d as ne,e as n,fa as k,h as H,ha as B,ka as I,l as h,m as b,ma as A,o as d,p as V,q as C,ra as D,ta as m,ua as S,va as L,wa as g,ya as N,z as f,za as W}from"./chunk-VE5QODOT.js";var G=ne(se());var x=class o{constructor(t){this.firestore=t}getEspecialistasPorEspecialidad(t){return n(this,null,function*(){let e=m(this.firestore,"users");return(yield g(e)).docs.map(r=>u({id:r.id},r.data())).filter(r=>this.especialistaValido(r,t))})}especialistaValido(t,e){return t.rol==="especialista"&&t.especialidadId===e}getHorariosPorEspecialista(t){return n(this,null,function*(){let e=m(this.firestore,"horarios"),i=yield g(e),r=yield this.getTurnosPorEspecialista(t);return i.docs.map(a=>{let E=a.data();return u({id:a.id},E)}).filter(a=>a.especialistaId===t&&this.isWithinNext15Days(a.fecha)&&!this.isHorarioOcupado(a,r))})}getTurnosPorEspecialista(t){return n(this,null,function*(){let e=m(this.firestore,"turnos");return(yield g(e)).docs.map(r=>{let a=r.data();return u({id:r.id},a)}).filter(r=>r.especialistaId===t)})}isHorarioOcupado(t,e){let i=new Date(t.fecha),r=new Date(i);return r.setMinutes(r.getMinutes()+30),e.some(a=>{let E=new Date(a.fecha),M=new Date(E);return M.setMinutes(M.getMinutes()+30),E<r&&M>i})}isWithinNext15Days(t){let e=new Date(t),i=new Date,r=new Date;return r.setDate(i.getDate()+15),e>=i&&e<=r}solicitarTurno(t){return n(this,null,function*(){let e=S(m(this.firestore,"turnos"));yield N(e,t)})}static \u0275fac=function(e){return new(e||o)(d(D))};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};var R=class o{constructor(t){this.firestore=t}solicitarTurno(t){return n(this,null,function*(){let e=S(m(this.firestore,"turnos"));yield N(e,t)})}getTurnos(){return n(this,null,function*(){let t=m(this.firestore,"turnos");return(yield g(t)).docs.map(i=>u({id:i.id},i.data()))})}getTurno(t){return n(this,null,function*(){let e=S(this.firestore,`turnos/${t}`),i=yield L(e);if(i.exists())return u({id:i.id},i.data());throw new Error("No se encontr\xF3 el turno")})}updateTurno(t,e){return n(this,null,function*(){let i=S(this.firestore,`turnos/${t}`);yield W(i,e)})}static \u0275fac=function(e){return new(e||o)(d(D))};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};function ue(o,t){if(o&1&&(s(0,"option",15),l(1),c()),o&2){let e=t.$implicit;p("value",e.id),f(),O(e.nombre)}}function de(o,t){if(o&1&&(s(0,"option",15),l(1),c()),o&2){let e=t.$implicit;p("value",e.id),f(),O(e.nombre)}}function fe(o,t){if(o&1&&(s(0,"option",15),l(1),c()),o&2){let e=t.$implicit;p("value",e.id),f(),$("",e.fecha," - ",e.hora,"")}}var j=class o{constructor(t,e,i,r,a){this.especialidadService=t;this.especialistaService=e;this.turnoService=i;this.fb=r;this.router=a;this.turnoForm=this.fb.group({especialidad:[""],especialista:[""],horario:[""],paciente:[""]})}especialidades=[];especialistas=[];horarios=[];turnoForm;ngOnInit(){this.cargarEspecialidades()}cargarEspecialidades(){return n(this,null,function*(){this.especialidades=yield this.especialidadService.getEspecialidades()})}onEspecialidadChange(t){return n(this,null,function*(){let i=t.target.value;this.especialistas=yield this.especialistaService.getEspecialistasPorEspecialidad(i)})}onEspecialistaChange(t){return n(this,null,function*(){let i=t.target.value;this.horarios=yield this.especialistaService.getHorariosPorEspecialista(i)})}solicitarTurno(){return n(this,null,function*(){let t=this.turnoForm.value;try{yield this.turnoService.solicitarTurno(t),G.default.fire("Registro exitoso","El turno ha sido solicitado correctamente","success"),this.router.navigate(["/bienvenida"])}catch{G.default.fire("Error","No se pudo solicitar el turno. Int\xE9ntalo nuevamente.","error")}})}setPaciente(t){this.turnoForm.patchValue({paciente:t.nombre,dni:t.dni,obraSocial:t.obraSocial})}static \u0275fac=function(e){return new(e||o)(v(re),v(x),v(R),v(ie),v(I))};static \u0275cmp=V({type:o,selectors:[["app-solicitar-turno"]],decls:24,vars:4,consts:[[3,"ngSubmit","formGroup"],["for","especialidad"],["id","especialidad","formControlName","especialidad",3,"change"],[3,"value",4,"ngFor","ngForOf"],["for","especialista"],["id","especialista","formControlName","especialista",3,"change"],["for","horario"],["id","horario","formControlName","horario"],["for","paciente"],["id","paciente","formControlName","paciente","type","text"],["for","dni"],["id","dni","formControlName","dni","type","text"],["for","obraSocial"],["id","obraSocial","formControlName","obraSocial","type","text"],["type","submit"],[3,"value"]],template:function(e,i){e&1&&(s(0,"form",0),w("ngSubmit",function(){return i.solicitarTurno()}),s(1,"label",1),l(2,"Especialidad:"),c(),s(3,"select",2),w("change",function(a){return i.onEspecialidadChange(a)}),T(4,ue,2,2,"option",3),c(),s(5,"label",4),l(6,"Especialista:"),c(),s(7,"select",5),w("change",function(a){return i.onEspecialistaChange(a)}),T(8,de,2,2,"option",3),c(),s(9,"label",6),l(10,"Horario:"),c(),s(11,"select",7),T(12,fe,2,3,"option",3),c(),s(13,"label",8),l(14,"Paciente:"),c(),F(15,"input",9),s(16,"label",10),l(17,"DNI:"),c(),F(18,"input",11),s(19,"label",12),l(20,"Obra Social:"),c(),F(21,"input",13),s(22,"button",14),l(23,"Solicitar Turno"),c()()),e&2&&(p("formGroup",i.turnoForm),f(4),p("ngForOf",i.especialidades),f(4),p("ngForOf",i.especialistas),f(4),p("ngForOf",i.horarios))},dependencies:[k,Q,ee,te,z,Z,J,K,X,Y]})};var _=class o{constructor(t,e){this.authService=t;this.router=e}canActivate(t,e){return this.authService.getUser().pipe(H(i=>i&&i.role==="paciente"?!0:(this.router.navigate(["/home"]),console.log("no es paciente verifica las cosas bien"),!1)))}static \u0275fac=function(e){return new(e||o)(d(q),d(I))};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};var he=[{path:"solicitar-turno",component:j,canActivate:[U,_]}],P=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=C({type:o});static \u0275inj=b({imports:[A.forChild(he),A]})};var ae=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=C({type:o});static \u0275inj=b({imports:[B,P,oe]})};export{ae as SeccionTurnosModule};
