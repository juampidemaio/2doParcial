import{a as Ie,b as Fe,c as we}from"./chunk-OKKJHMAL.js";import{a as L,b as y,c as W,d as q,e as fe,f as ge,g as z,h as he,i as be,j as Se,k as ve,l as _e,m as ye,n as Ce,o as xe,p as Ee,q as Te}from"./chunk-UHOHH35X.js";import{$ as pe,A as g,Aa as me,Ba as U,Da as P,E as b,Fa as I,G as p,I as a,J as s,K as V,L as M,M as S,N as v,O as Z,P as u,Q as D,R as se,S as ce,T as ee,U as ie,V as oe,Y as le,a as O,aa as de,d as ne,e as l,h as ae,ja as k,ka as G,l as C,la as ue,m as A,ma as te,o as h,p as j,pa as H,q as R,ra as re,t as x,u as E,wa as $,ya as _,z as c,za as T}from"./chunk-E2NVOQIH.js";var Pe=ne(Ee());var B=class t{constructor(i){this.firestore=i}getEspecialistasPorEspecialidad(i){return l(this,null,function*(){let e=_(this.firestore,"users"),r=(yield U(e)).docs.map(n=>O({id:n.id},n.data())).filter(n=>this.especialistaValido(n,i));return console.log("Especialistas filtrados:",r),r})}especialistaValido(i,e){return i.role==="especialista"&&i.especialidades.includes(e)}getHorariosPorEspecialista(i){return l(this,null,function*(){let e=_(this.firestore,"horarios"),o=yield U(e),r=yield this.getTurnosPorEspecialista(i);return o.docs.map(n=>{let d=n.data();return O({id:n.id},d)}).filter(n=>n.especialistaId===i&&this.isWithinNext15Days(n.fecha)&&!this.isHorarioOcupado(n,r))})}getTurnosPorEspecialista(i){return l(this,null,function*(){let e=_(this.firestore,"turnos");return(yield U(e)).docs.map(r=>{let n=r.data();return O({id:r.id},n)}).filter(r=>r.especialistaId===i)})}isHorarioOcupado(i,e){let o=new Date(i.fecha),r=new Date(o);return r.setMinutes(r.getMinutes()+30),e.some(n=>{let d=new Date(n.fecha),f=new Date(d);return f.setMinutes(f.getMinutes()+30),d<r&&f>o})}isWithinNext15Days(i){let e=new Date(i),o=new Date,r=new Date;return r.setDate(o.getDate()+15),e>=o&&e<=r}solicitarTurno(i){return l(this,null,function*(){let e=T(_(this.firestore,"turnos"));yield P(e,i)})}static \u0275fac=function(e){return new(e||t)(h($))};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})};var w=class t{constructor(i,e){this.firestore=i;this.authService=e}guardarDisponibilidad(i,e){return l(this,null,function*(){let o=T(_(this.firestore,"Disponibilidad"),i);yield P(o,{disponibilidad:e})})}guardarTurnos(i){return l(this,null,function*(){let e=_(this.firestore,"Turnos"),o=i.map(r=>{let n=T(e);return P(n,r)});yield Promise.all(o)})}obtenerDisponibilidad(i){return l(this,null,function*(){let e=T(this.firestore,`Disponibilidad/${i}`),o=yield me(e);return o.exists()?o.data().disponibilidad:(console.log("No existe la disponibilidad para este especialista."),null)})}static \u0275fac=function(e){return new(e||t)(h($),h(I))};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})};function Ge(t,i){if(t&1&&(a(0,"option",11),u(1),s()),t&2){let e=i.$implicit;p("value",e.nombre),c(),D(e.nombre)}}function He(t,i){if(t&1&&(a(0,"option",11),u(1),s()),t&2){let e=i.$implicit;p("value",e.nombre),c(),D(e.nombre)}}function $e(t,i){if(t&1&&(a(0,"option",11),u(1),s()),t&2){let e=i.$implicit;p("value",e.id),c(),ce("",e.fecha," - ",e.hora,"")}}function Ue(t,i){if(t&1&&(a(0,"div")(1,"label",12),u(2,"Paciente:"),s(),V(3,"input",13),a(4,"label",14),u(5,"DNI:"),s(),V(6,"input",15),a(7,"label",16),u(8,"Obra Social:"),s(),V(9,"input",17),s()),t&2){let e=v();c(3),p("readonly",e.isAdmin),c(3),p("readonly",e.isAdmin),c(3),p("readonly",e.isAdmin)}}function Le(t,i){if(t&1){let e=M();a(0,"app-listado-paciente",18),S("usuarioSeleccionado",function(r){x(e);let n=v();return E(n.setPacienteData(r))}),s()}}var Y=class t{constructor(i,e,o,r,n,d){this.especialidadService=i;this.especialistaService=e;this.turnoService=o;this.authService=r;this.fb=n;this.router=d;this.turnoForm=this.fb.group({especialidad:["",y.required],especialista:["",y.required],horario:["",y.required],paciente:["",y.required],dni:["",[y.required,y.pattern(/^[0-9]{8,}$/)]],obraSocial:["",y.required]})}especialidades=[];especialistas=[];horarios=[];turnoForm;isAdmin=!1;isPaciente=!1;usuarioSeleccionado;ngOnInit(){this.cargarEspecialidades(),this.checkUserRole()}cargarEspecialidades(){return l(this,null,function*(){this.especialidades=yield this.especialidadService.getEspecialidades()})}checkUserRole(){return l(this,null,function*(){this.authService.getUser().subscribe(i=>{i&&(this.isAdmin=i.role==="administrador",this.isPaciente=i.role==="paciente")})})}setPacienteData(i){return l(this,null,function*(){this.usuarioSeleccionado=i,i&&this.turnoForm.patchValue({paciente:i.nombre,dni:i.dni,obraSocial:i.obraSocial})})}onEspecialidadChange(i){return l(this,null,function*(){let o=i.target.value;if(console.log("Nombre de especialidad seleccionada:",o),o)try{this.especialistas=yield this.especialistaService.getEspecialistasPorEspecialidad(o),console.log("Especialistas cargados:",this.especialistas)}catch(r){console.error("Error al cargar especialistas:",r),Pe.default.fire("Error","No se pudieron cargar los especialistas","error")}else this.especialistas=[]})}onEspecialistaChange(i){return l(this,null,function*(){let o=i.target.value;this.horarios=yield this.especialistaService.getHorariosPorEspecialista(o)})}solicitarTurno(){return l(this,null,function*(){})}static \u0275fac=function(e){return new(e||t)(g(Te),g(B),g(w),g(I),g(ye),g(H))};static \u0275cmp=j({type:t,selectors:[["app-solicitar-turno"]],decls:17,vars:6,consts:[[3,"ngSubmit","formGroup"],["for","especialidad"],["id","especialidad","formControlName","especialidad",3,"change"],[3,"value",4,"ngFor","ngForOf"],["for","especialista"],["id","especialista","formControlName","especialista",3,"change"],["for","horario"],["id","horario","formControlName","horario"],[4,"ngIf"],[3,"usuarioSeleccionado",4,"ngIf"],["type","submit"],[3,"value"],["for","paciente"],["id","paciente","formControlName","paciente","type","text",3,"readonly"],["for","dni"],["id","dni","formControlName","dni","type","text",3,"readonly"],["for","obraSocial"],["id","obraSocial","formControlName","obraSocial","type","text",3,"readonly"],[3,"usuarioSeleccionado"]],template:function(e,o){e&1&&(a(0,"form",0),S("ngSubmit",function(){return o.solicitarTurno()}),a(1,"label",1),u(2,"Especialidad:"),s(),a(3,"select",2),S("change",function(n){return o.onEspecialidadChange(n)}),b(4,Ge,2,2,"option",3),s(),a(5,"label",4),u(6,"Especialista:"),s(),a(7,"select",5),S("change",function(n){return o.onEspecialistaChange(n)}),b(8,He,2,2,"option",3),s(),a(9,"label",6),u(10,"Horario:"),s(),a(11,"select",7),b(12,$e,2,3,"option",3),s(),b(13,Ue,10,3,"div",8)(14,Le,1,0,"app-listado-paciente",9),a(15,"button",10),u(16,"Solicitar Turno"),s()()),e&2&&(p("formGroup",o.turnoForm),c(4),p("ngForOf",o.especialidades),c(4),p("ngForOf",o.especialistas),c(4),p("ngForOf",o.horarios),c(),p("ngIf",o.isAdmin),c(),p("ngIf",o.isAdmin))},dependencies:[k,G,z,ve,_e,L,Se,W,q,he,be,Ie],styles:['@charset "UTF-8";form[_ngcontent-%COMP%]{max-width:800px;margin:20px auto;padding:30px;border:2px solid #007bff;border-radius:15px;background-color:#e0f7fa;box-shadow:0 4px 20px #0003}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px;display:block;color:#007bff}input[type=text][_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #007bff;border-radius:6px;font-size:16px;margin-bottom:15px;box-sizing:border-box;transition:border-color .3s,background-color .3s;background-color:#f1f1f1}input[type=text][_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{border-color:#0056b3;outline:none;background-color:#fff}div[ngIf][_ngcontent-%COMP%]{color:#dc3545;font-size:.9em;margin-top:-10px;margin-bottom:10px}button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 15px;border:none;border-radius:6px;cursor:pointer;transition:background-color .3s,transform .2s;width:100%;font-size:1em}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:translateY(-2px)}div[_ngcontent-%COMP%]{margin-bottom:20px}div[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ngIf[_ngcontent-%COMP%]{margin-bottom:20px}']})};var J=class t{constructor(i,e){this.authService=i;this.router=e}canActivate(i,e){return this.authService.getUser().pipe(ae(o=>o&&(o.role==="administrador"||o.role==="paciente")?!0:(this.router.navigate(["/bienvenida"]),console.log("Acceso denegado: no es administrador ni paciente"),!1)))}static \u0275fac=function(e){return new(e||t)(h(I),h(H))};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})};var m=ne(Ee());var We=()=>["lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado","domingo"];function qe(t,i){if(t&1){let e=M();a(0,"div")(1,"label"),u(2),pe(3,"titlecase"),s(),a(4,"div",5)(5,"input",6),oe("ngModelChange",function(r){let n=x(e).$implicit,d=v(2);return ie(d.disponibilidadSemana[n].horaInicio,r)||(d.disponibilidadSemana[n].horaInicio=r),E(r)}),s(),a(6,"input",7),oe("ngModelChange",function(r){let n=x(e).$implicit,d=v(2);return ie(d.disponibilidadSemana[n].horaFin,r)||(d.disponibilidadSemana[n].horaFin=r),E(r)}),s()()()}if(t&2){let e=i.$implicit,o=v(2);c(2),D(de(3,7,e)),c(3),Z("name","",e,"HoraInicio"),ee("ngModel",o.disponibilidadSemana[e].horaInicio),c(),Z("name","",e,"HoraFin"),ee("ngModel",o.disponibilidadSemana[e].horaFin)}}function ze(t,i){if(t&1){let e=M();a(0,"div")(1,"form",2),S("ngSubmit",function(){x(e);let r=v();return E(r.guardarDisponibilidad())}),b(2,qe,7,9,"div",3),a(3,"button",4),u(4,"Guardar Disponibilidad"),s()()()}t&2&&(c(2),p("ngForOf",le(1,We)))}function Be(t,i){t&1&&(a(0,"p"),u(1,"Selecciona un especialista para asignar disponibilidad."),s())}var K=class t{constructor(i){this.turnoService=i}usuarioSeleccionado=null;disponibilidadSemana={lunes:{horaInicio:"",horaFin:""},martes:{horaInicio:"",horaFin:""},mi\u00E9rcoles:{horaInicio:"",horaFin:""},jueves:{horaInicio:"",horaFin:""},viernes:{horaInicio:"",horaFin:""},s\u00E1bado:{horaInicio:"",horaFin:""},domingo:{horaInicio:"",horaFin:""}};horariosClinica={lunes:{apertura:"08:00",cierre:"19:00"},martes:{apertura:"08:00",cierre:"19:00"},mi\u00E9rcoles:{apertura:"08:00",cierre:"19:00"},jueves:{apertura:"08:00",cierre:"19:00"},viernes:{apertura:"08:00",cierre:"19:00"},s\u00E1bado:{apertura:"08:00",cierre:"14:00"},domingo:{apertura:null,cierre:null}};ngOnInit(){this.generarTurnosProximos15Dias()}mostrarUsuario(i){this.usuarioSeleccionado=i}esHorarioValido(i){let e=parseInt(i.split(":")[1],10);return e===0||e===30}guardarDisponibilidad(){return l(this,null,function*(){if(!this.usuarioSeleccionado){m.default.fire("Error","Por favor, selecciona un especialista.","error");return}for(let i in this.disponibilidadSemana){let e=this.disponibilidadSemana[i],o=this.horariosClinica[i];if(e.horaInicio&&!this.esHorarioValido(e.horaInicio)||e.horaFin&&!this.esHorarioValido(e.horaFin)){m.default.fire("Error",`Los horarios de ${i} deben ser en intervalos de media hora (ej. 08:00 o 08:30).`,"error");return}if(o.apertura&&o.cierre){if(e.horaInicio<o.apertura||e.horaInicio>o.cierre||e.horaFin<o.apertura||e.horaFin>o.cierre){m.default.fire("Error",`El horario de ${i} debe estar entre ${o.apertura} y ${o.cierre}.`,"error");return}if(e.horaInicio>=e.horaFin){m.default.fire("Error",`En ${i}, la hora de inicio debe ser anterior a la hora de fin.`,"error");return}}else if(e.horaInicio||e.horaFin){m.default.fire("Error",`El d\xEDa ${i} est\xE1 cerrado, no debe haber horarios de disponibilidad.`,"error");return}}try{yield this.turnoService.guardarDisponibilidad(this.usuarioSeleccionado.uid,this.disponibilidadSemana),m.default.fire("\xC9xito","Disponibilidad guardada correctamente.","success")}catch(i){console.error("Error al guardar la disponibilidad:",i),m.default.fire("Error","No se pudo guardar la disponibilidad.","error")}})}generarTurnosProximos15Dias(){return l(this,null,function*(){if(!this.usuarioSeleccionado){m.default.fire("Error","Por favor, selecciona un especialista.","error");return}let i=yield this.turnoService.obtenerDisponibilidad(this.usuarioSeleccionado.uid);if(!i){m.default.fire("Error","No se encontr\xF3 disponibilidad para el especialista seleccionado.","error");return}let e=[],o=new Date;for(let r=0;r<15;r++){let n=new Date(o);n.setDate(o.getDate()+r);let d=this.obtenerNombreDia(n);if(i[d]){let f=i[d];if(f.horaInicio&&f.horaFin){let N=f.horaInicio;for(;N<f.horaFin;){let X=this.sumarMinutos(N,30);X<=f.horaFin&&e.push({especialista_id:this.usuarioSeleccionado.uid,fecha:n.toISOString().split("T")[0],hora_inicio:N,hora_fin:X,estado:"disponible"}),N=X}}}}try{yield this.turnoService.guardarTurnos(e),m.default.fire("\xC9xito","Turnos generados para los pr\xF3ximos 15 d\xEDas.","success")}catch(r){console.error("Error al generar los turnos:",r),m.default.fire("Error","No se pudieron generar los turnos.","error")}})}obtenerNombreDia(i){return["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"][i.getDay()]}sumarMinutos(i,e){let[o,r]=i.split(":").map(Number),n=new Date;n.setHours(o,r+e);let d=String(n.getHours()).padStart(2,"0"),f=String(n.getMinutes()).padStart(2,"0");return`${d}:${f}`}static \u0275fac=function(e){return new(e||t)(g(w))};static \u0275cmp=j({type:t,selectors:[["app-gestion-turnos"]],decls:5,vars:3,consts:[[3,"usuarioSeleccionado"],[4,"ngIf"],[3,"ngSubmit"],[4,"ngFor","ngForOf"],["type","submit"],[1,"horarios"],["type","time","placeholder","Hora de inicio",3,"ngModelChange","ngModel","name"],["type","time","placeholder","Hora de fin",3,"ngModelChange","ngModel","name"]],template:function(e,o){e&1&&(a(0,"app-listado-especialista",0),S("usuarioSeleccionado",function(n){return o.mostrarUsuario(n)}),s(),a(1,"h2"),u(2),s(),b(3,ze,5,2,"div",1)(4,Be,2,0,"p",1)),e&2&&(c(2),se("Asignar Disponibilidad para ",(o.usuarioSeleccionado==null?null:o.usuarioSeleccionado.nombre)||"Selecciona un especialista",""),c(),p("ngIf",o.usuarioSeleccionado),c(),p("ngIf",!o.usuarioSeleccionado))},dependencies:[k,G,z,L,W,q,Fe,ge,fe,ue],styles:['@charset "UTF-8";form[_ngcontent-%COMP%]{max-width:800px;margin:20px auto;padding:30px;border:2px solid #007bff;border-radius:15px;background-color:#e0f7fa;box-shadow:0 4px 20px #0003}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px;display:block;color:#007bff}.horarios[_ngcontent-%COMP%]{display:flex;gap:15px}input[type=time][_ngcontent-%COMP%]{width:48%;padding:12px;border:1px solid #007bff;border-radius:6px;font-size:16px;box-sizing:border-box;background-color:#f1f1f1;transition:border-color .3s,background-color .3s}input[type=time][_ngcontent-%COMP%]:focus{border-color:#0056b3;outline:none;background-color:#fff}button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 15px;border:none;border-radius:6px;cursor:pointer;transition:background-color .3s,transform .2s;width:100%;font-size:1em}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:translateY(-2px)}div[_ngcontent-%COMP%]{margin-bottom:20px}']})};var Ye=[{path:"solicitar-turno",component:Y,canActivate:[J]},{path:"gestionar-turno",component:K}],Q=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=R({type:t});static \u0275inj=A({imports:[re.forChild(Ye),re]})};var Ne=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=R({type:t});static \u0275inj=A({imports:[te,Q,xe,we,te,Ce]})};export{Ne as SeccionTurnosModule};
