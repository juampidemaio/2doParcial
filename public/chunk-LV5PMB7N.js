import{a as xe,b as Ee,c as Te}from"./chunk-OKKJHMAL.js";import{a as U,b as S,c as W,d as $,e as de,f as me,g as q,h as ue,i as fe,j as ge,k as he,l as be,m as Se,n as ve,o as _e,p as ye,q as Ce}from"./chunk-UHOHH35X.js";import{$ as ce,A as u,Ba as V,Da as H,E as g,Fa as E,G as l,I as a,J as s,K as N,L as F,M as h,N as b,O as Q,P as d,Q as w,R as ne,S as ae,T as X,U as Z,V as ee,Y as se,a as M,aa as le,d as oe,e as p,h as re,ja as A,ka as j,l as y,la as pe,m as P,ma as ie,o as f,p as D,pa as R,q as O,ra as te,t as C,u as x,wa as k,ya as v,z as c,za as G}from"./chunk-E2NVOQIH.js";var we=oe(ye());var z=class o{constructor(i){this.firestore=i}getEspecialistasPorEspecialidad(i){return p(this,null,function*(){let e=v(this.firestore,"users"),r=(yield V(e)).docs.map(n=>M({id:n.id},n.data())).filter(n=>this.especialistaValido(n,i));return console.log("Especialistas filtrados:",r),r})}especialistaValido(i,e){return i.role==="especialista"&&i.especialidades.includes(e)}getHorariosPorEspecialista(i){return p(this,null,function*(){let e=v(this.firestore,"horarios"),t=yield V(e),r=yield this.getTurnosPorEspecialista(i);return t.docs.map(n=>{let m=n.data();return M({id:n.id},m)}).filter(n=>n.especialistaId===i&&this.isWithinNext15Days(n.fecha)&&!this.isHorarioOcupado(n,r))})}getTurnosPorEspecialista(i){return p(this,null,function*(){let e=v(this.firestore,"turnos");return(yield V(e)).docs.map(r=>{let n=r.data();return M({id:r.id},n)}).filter(r=>r.especialistaId===i)})}isHorarioOcupado(i,e){let t=new Date(i.fecha),r=new Date(t);return r.setMinutes(r.getMinutes()+30),e.some(n=>{let m=new Date(n.fecha),K=new Date(m);return K.setMinutes(K.getMinutes()+30),m<r&&K>t})}isWithinNext15Days(i){let e=new Date(i),t=new Date,r=new Date;return r.setDate(t.getDate()+15),e>=t&&e<=r}solicitarTurno(i){return p(this,null,function*(){let e=G(v(this.firestore,"turnos"));yield H(e,i)})}static \u0275fac=function(e){return new(e||o)(f(k))};static \u0275prov=y({token:o,factory:o.\u0275fac,providedIn:"root"})};var I=class o{constructor(i,e){this.firestore=i;this.authService=e}horariosApertura={lunes:{apertura:"08:00",cierre:"19:00"},martes:{apertura:"08:00",cierre:"19:00"},mi\u00E9rcoles:{apertura:"08:00",cierre:"19:00"},jueves:{apertura:"08:00",cierre:"19:00"},viernes:{apertura:"08:00",cierre:"19:00"},s\u00E1bado:{apertura:"08:00",cierre:"14:00"},domingo:{apertura:null,cierre:null}};guardarDisponibilidad(i,e){return p(this,null,function*(){let t=G(v(this.firestore,"Disponibilidad"),i);yield H(t,{disponibilidad:e})})}static \u0275fac=function(e){return new(e||o)(f(k),f(E))};static \u0275prov=y({token:o,factory:o.\u0275fac,providedIn:"root"})};function Re(o,i){if(o&1&&(a(0,"option",11),d(1),s()),o&2){let e=i.$implicit;l("value",e.nombre),c(),w(e.nombre)}}function ke(o,i){if(o&1&&(a(0,"option",11),d(1),s()),o&2){let e=i.$implicit;l("value",e.nombre),c(),w(e.nombre)}}function Ge(o,i){if(o&1&&(a(0,"option",11),d(1),s()),o&2){let e=i.$implicit;l("value",e.id),c(),ae("",e.fecha," - ",e.hora,"")}}function Ve(o,i){if(o&1&&(a(0,"div")(1,"label",12),d(2,"Paciente:"),s(),N(3,"input",13),a(4,"label",14),d(5,"DNI:"),s(),N(6,"input",15),a(7,"label",16),d(8,"Obra Social:"),s(),N(9,"input",17),s()),o&2){let e=b();c(3),l("readonly",e.isAdmin),c(3),l("readonly",e.isAdmin),c(3),l("readonly",e.isAdmin)}}function He(o,i){if(o&1){let e=F();a(0,"app-listado-paciente",18),h("usuarioSeleccionado",function(r){C(e);let n=b();return x(n.setPacienteData(r))}),s()}}var L=class o{constructor(i,e,t,r,n,m){this.especialidadService=i;this.especialistaService=e;this.turnoService=t;this.authService=r;this.fb=n;this.router=m;this.turnoForm=this.fb.group({especialidad:["",S.required],especialista:["",S.required],horario:["",S.required],paciente:["",S.required],dni:["",[S.required,S.pattern(/^[0-9]{8,}$/)]],obraSocial:["",S.required]})}especialidades=[];especialistas=[];horarios=[];turnoForm;isAdmin=!1;isPaciente=!1;usuarioSeleccionado;ngOnInit(){this.cargarEspecialidades(),this.checkUserRole()}cargarEspecialidades(){return p(this,null,function*(){this.especialidades=yield this.especialidadService.getEspecialidades()})}checkUserRole(){return p(this,null,function*(){this.authService.getUser().subscribe(i=>{i&&(this.isAdmin=i.role==="administrador",this.isPaciente=i.role==="paciente")})})}setPacienteData(i){return p(this,null,function*(){this.usuarioSeleccionado=i,i&&this.turnoForm.patchValue({paciente:i.nombre,dni:i.dni,obraSocial:i.obraSocial})})}onEspecialidadChange(i){return p(this,null,function*(){let t=i.target.value;if(console.log("Nombre de especialidad seleccionada:",t),t)try{this.especialistas=yield this.especialistaService.getEspecialistasPorEspecialidad(t),console.log("Especialistas cargados:",this.especialistas)}catch(r){console.error("Error al cargar especialistas:",r),we.default.fire("Error","No se pudieron cargar los especialistas","error")}else this.especialistas=[]})}onEspecialistaChange(i){return p(this,null,function*(){let t=i.target.value;this.horarios=yield this.especialistaService.getHorariosPorEspecialista(t)})}solicitarTurno(){return p(this,null,function*(){})}static \u0275fac=function(e){return new(e||o)(u(Ce),u(z),u(I),u(E),u(Se),u(R))};static \u0275cmp=D({type:o,selectors:[["app-solicitar-turno"]],decls:17,vars:6,consts:[[3,"ngSubmit","formGroup"],["for","especialidad"],["id","especialidad","formControlName","especialidad",3,"change"],[3,"value",4,"ngFor","ngForOf"],["for","especialista"],["id","especialista","formControlName","especialista",3,"change"],["for","horario"],["id","horario","formControlName","horario"],[4,"ngIf"],[3,"usuarioSeleccionado",4,"ngIf"],["type","submit"],[3,"value"],["for","paciente"],["id","paciente","formControlName","paciente","type","text",3,"readonly"],["for","dni"],["id","dni","formControlName","dni","type","text",3,"readonly"],["for","obraSocial"],["id","obraSocial","formControlName","obraSocial","type","text",3,"readonly"],[3,"usuarioSeleccionado"]],template:function(e,t){e&1&&(a(0,"form",0),h("ngSubmit",function(){return t.solicitarTurno()}),a(1,"label",1),d(2,"Especialidad:"),s(),a(3,"select",2),h("change",function(n){return t.onEspecialidadChange(n)}),g(4,Re,2,2,"option",3),s(),a(5,"label",4),d(6,"Especialista:"),s(),a(7,"select",5),h("change",function(n){return t.onEspecialistaChange(n)}),g(8,ke,2,2,"option",3),s(),a(9,"label",6),d(10,"Horario:"),s(),a(11,"select",7),g(12,Ge,2,3,"option",3),s(),g(13,Ve,10,3,"div",8)(14,He,1,0,"app-listado-paciente",9),a(15,"button",10),d(16,"Solicitar Turno"),s()()),e&2&&(l("formGroup",t.turnoForm),c(4),l("ngForOf",t.especialidades),c(4),l("ngForOf",t.especialistas),c(4),l("ngForOf",t.horarios),c(),l("ngIf",t.isAdmin),c(),l("ngIf",t.isAdmin))},dependencies:[A,j,q,he,be,U,ge,W,$,ue,fe,xe],styles:['@charset "UTF-8";form[_ngcontent-%COMP%]{max-width:800px;margin:20px auto;padding:30px;border:2px solid #007bff;border-radius:15px;background-color:#e0f7fa;box-shadow:0 4px 20px #0003}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px;display:block;color:#007bff}input[type=text][_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #007bff;border-radius:6px;font-size:16px;margin-bottom:15px;box-sizing:border-box;transition:border-color .3s,background-color .3s;background-color:#f1f1f1}input[type=text][_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{border-color:#0056b3;outline:none;background-color:#fff}div[ngIf][_ngcontent-%COMP%]{color:#dc3545;font-size:.9em;margin-top:-10px;margin-bottom:10px}button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 15px;border:none;border-radius:6px;cursor:pointer;transition:background-color .3s,transform .2s;width:100%;font-size:1em}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:translateY(-2px)}div[_ngcontent-%COMP%]{margin-bottom:20px}div[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ngIf[_ngcontent-%COMP%]{margin-bottom:20px}']})};var B=class o{constructor(i,e){this.authService=i;this.router=e}canActivate(i,e){return this.authService.getUser().pipe(re(t=>t&&(t.role==="administrador"||t.role==="paciente")?!0:(this.router.navigate(["/bienvenida"]),console.log("Acceso denegado: no es administrador ni paciente"),!1)))}static \u0275fac=function(e){return new(e||o)(f(E),f(R))};static \u0275prov=y({token:o,factory:o.\u0275fac,providedIn:"root"})};var _=oe(ye());var Ue=()=>["lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado","domingo"];function We(o,i){if(o&1){let e=F();a(0,"div")(1,"label"),d(2),ce(3,"titlecase"),s(),a(4,"div",5)(5,"input",6),ee("ngModelChange",function(r){let n=C(e).$implicit,m=b(2);return Z(m.disponibilidadSemana[n].horaInicio,r)||(m.disponibilidadSemana[n].horaInicio=r),x(r)}),s(),a(6,"input",7),ee("ngModelChange",function(r){let n=C(e).$implicit,m=b(2);return Z(m.disponibilidadSemana[n].horaFin,r)||(m.disponibilidadSemana[n].horaFin=r),x(r)}),s()()()}if(o&2){let e=i.$implicit,t=b(2);c(2),w(le(3,7,e)),c(3),Q("name","",e,"HoraInicio"),X("ngModel",t.disponibilidadSemana[e].horaInicio),c(),Q("name","",e,"HoraFin"),X("ngModel",t.disponibilidadSemana[e].horaFin)}}function $e(o,i){if(o&1){let e=F();a(0,"div")(1,"form",2),h("ngSubmit",function(){C(e);let r=b();return x(r.guardarDisponibilidad())}),g(2,We,7,9,"div",3),a(3,"button",4),d(4,"Guardar Disponibilidad"),s()()()}o&2&&(c(2),l("ngForOf",se(1,Ue)))}function qe(o,i){o&1&&(a(0,"p"),d(1,"Selecciona un especialista para asignar disponibilidad."),s())}var Y=class o{constructor(i){this.turnoService=i}usuarioSeleccionado=null;disponibilidadSemana={lunes:{horaInicio:"",horaFin:""},martes:{horaInicio:"",horaFin:""},mi\u00E9rcoles:{horaInicio:"",horaFin:""},jueves:{horaInicio:"",horaFin:""},viernes:{horaInicio:"",horaFin:""},s\u00E1bado:{horaInicio:"",horaFin:""},domingo:{horaInicio:"",horaFin:""}};horariosClinica={lunes:{apertura:"08:00",cierre:"19:00"},martes:{apertura:"08:00",cierre:"19:00"},mi\u00E9rcoles:{apertura:"08:00",cierre:"19:00"},jueves:{apertura:"08:00",cierre:"19:00"},viernes:{apertura:"08:00",cierre:"19:00"},s\u00E1bado:{apertura:"08:00",cierre:"14:00"},domingo:{apertura:null,cierre:null}};mostrarUsuario(i){this.usuarioSeleccionado=i}guardarDisponibilidad(){return p(this,null,function*(){if(!this.usuarioSeleccionado){_.default.fire("Error","Por favor, selecciona un especialista.","error");return}for(let i in this.disponibilidadSemana){let e=this.disponibilidadSemana[i],t=this.horariosClinica[i];if(t.apertura&&t.cierre){if(e.horaInicio<t.apertura||e.horaInicio>t.cierre||e.horaFin<t.apertura||e.horaFin>t.cierre){_.default.fire("Error",`El horario de ${i} debe estar entre ${t.apertura} y ${t.cierre}.`,"error");return}if(e.horaInicio>=e.horaFin){_.default.fire("Error",`En ${i}, la hora de inicio debe ser anterior a la hora de fin.`,"error");return}}else if(e.horaInicio||e.horaFin){_.default.fire("Error",`El d\xEDa ${i} est\xE1 cerrado, no debe haber horarios de disponibilidad.`,"error");return}}try{yield this.turnoService.guardarDisponibilidad(this.usuarioSeleccionado.uid,this.disponibilidadSemana),_.default.fire("\xC9xito","Disponibilidad guardada correctamente.","success")}catch(i){console.error("Error al guardar la disponibilidad:",i),_.default.fire("Error","No se pudo guardar la disponibilidad.","error")}})}static \u0275fac=function(e){return new(e||o)(u(I))};static \u0275cmp=D({type:o,selectors:[["app-gestion-turnos"]],decls:5,vars:3,consts:[[3,"usuarioSeleccionado"],[4,"ngIf"],[3,"ngSubmit"],[4,"ngFor","ngForOf"],["type","submit"],[1,"horarios"],["type","time","placeholder","Hora de inicio",3,"ngModelChange","ngModel","name"],["type","time","placeholder","Hora de fin",3,"ngModelChange","ngModel","name"]],template:function(e,t){e&1&&(a(0,"app-listado-especialista",0),h("usuarioSeleccionado",function(n){return t.mostrarUsuario(n)}),s(),a(1,"h2"),d(2),s(),g(3,$e,5,2,"div",1)(4,qe,2,0,"p",1)),e&2&&(c(2),ne("Asignar Disponibilidad para ",(t.usuarioSeleccionado==null?null:t.usuarioSeleccionado.nombre)||"Selecciona un especialista",""),c(),l("ngIf",t.usuarioSeleccionado),c(),l("ngIf",!t.usuarioSeleccionado))},dependencies:[A,j,q,U,W,$,Ee,me,de,pe],styles:['@charset "UTF-8";form[_ngcontent-%COMP%]{max-width:800px;margin:20px auto;padding:30px;border:2px solid #007bff;border-radius:15px;background-color:#e0f7fa;box-shadow:0 4px 20px #0003}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px;display:block;color:#007bff}.horarios[_ngcontent-%COMP%]{display:flex;gap:15px}input[type=time][_ngcontent-%COMP%]{width:48%;padding:12px;border:1px solid #007bff;border-radius:6px;font-size:16px;box-sizing:border-box;background-color:#f1f1f1;transition:border-color .3s,background-color .3s}input[type=time][_ngcontent-%COMP%]:focus{border-color:#0056b3;outline:none;background-color:#fff}button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 15px;border:none;border-radius:6px;cursor:pointer;transition:background-color .3s,transform .2s;width:100%;font-size:1em}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:translateY(-2px)}div[_ngcontent-%COMP%]{margin-bottom:20px}']})};var ze=[{path:"solicitar-turno",component:L,canActivate:[B]},{path:"gestionar-turno",component:Y}],J=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=O({type:o});static \u0275inj=P({imports:[te.forChild(ze),te]})};var Me=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=O({type:o});static \u0275inj=P({imports:[ie,J,_e,Te,ie,ve]})};export{Me as SeccionTurnosModule};
