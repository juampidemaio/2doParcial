import{Aa as I,Da as l,Ga as d,Ia as y,La as m,d as P,f as D}from"./chunk-YD4HKJ23.js";import{a as c,g as p}from"./chunk-RA2WU32H.js";var S=class g{constructor(e){this.firestore=e}getEspecialistasPorEspecialidad(e){return p(this,null,function*(){let i=l(this.firestore,"users"),s=(yield d(i)).docs.map(t=>c({id:t.id},t.data())).filter(t=>this.especialistaValido(t,e));return console.log("Especialistas filtrados:",s),s})}getEspecialistas(){return p(this,null,function*(){let e=l(this.firestore,"users"),i=y(e,m("role","==","especialista")),s=(yield d(i)).docs.map(t=>c({id:t.id},t.data()));return console.log("Especialistas filtrados:",s),s})}especialistaValido(e,i){return e.role==="especialista"&&e.especialidades.includes(i)}getPacientesUnicosPorEspecialidad(e,i){return p(this,null,function*(){let a=l(this.firestore,"Turnos"),s=yield d(a),t=new Set,r=[],o=s.docs.map(n=>{let f=n.data();return c({id:n.id},f)}).filter(n=>{let f=n.especialista_id===e,w=n.especialidad===i;return f&&w&&t.add(n.pacienteId),f&&w});console.log("Turnos solicitados:",o);let h=Array.from(t);return yield this.getPacientesPorIds(h)})}getPacientesUnicosPorEspecialista(e){return p(this,null,function*(){let i=l(this.firestore,"Turnos"),a=yield d(i),s=new Set,t=[],r=a.docs.map(u=>{let n=u.data();return c({id:u.id},n)}).filter(u=>{let n=u.especialista_id===e;return n&&u.pacienteId&&s.add(u.pacienteId),n});console.log("Turnos solicitados:",r);let o=Array.from(s);return yield this.getPacientesPorIds(o)})}getPacientesPorIds(e){return p(this,null,function*(){let i=l(this.firestore,"users"),a=[];for(let s of e)if(s){let t=y(i,m("uid","==",s));(yield d(t)).forEach(o=>{let h=o.data();a.push(c({id:o.id},h))})}else console.warn("ID de paciente es undefined, omitiendo este ID.");return a})}getHorariosPorEspecialista(e){return p(this,null,function*(){let i=l(this.firestore,"horarios"),a=yield d(i),s=yield this.getTurnosPorEspecialista(e);return a.docs.map(t=>{let r=t.data();return c({id:t.id},r)}).filter(t=>t.especialistaId===e&&this.isWithinNext15Days(t.fecha)&&!this.isHorarioOcupado(t,s))})}getTurnosPorEspecialista(e){return p(this,null,function*(){let i=l(this.firestore,"turnos");return(yield d(i)).docs.map(s=>{let t=s.data();return c({id:s.id},t)}).filter(s=>s.especialistaId===e)})}isHorarioOcupado(e,i){let a=new Date(e.fecha),s=new Date(a);return s.setMinutes(s.getMinutes()+30),i.some(t=>{let r=new Date(t.fecha),o=new Date(r);return o.setMinutes(o.getMinutes()+30),r<s&&o>a})}isWithinNext15Days(e){let i=new Date(e),a=new Date,s=new Date;return s.setDate(a.getDate()+15),i>=a&&i<=s}static \u0275fac=function(i){return new(i||g)(D(I))};static \u0275prov=P({token:g,factory:g.\u0275fac,providedIn:"root"})};export{S as a};
