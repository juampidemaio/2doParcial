import{a as ce,b as le}from"./chunk-PKBAHFRJ.js";import{a as J,b as u,c as K,d as Q,e as X,f as Z,g as ee,h as te,i as ie,j as oe,k as re,l as ae,m as ne,n as fe,o as se}from"./chunk-PR3K6K2G.js";import{A as f,Aa as h,E as b,G as l,I as n,J as s,K as T,L as $,M as y,N as k,O as m,P as V,R as B,a as _,d as ue,e as c,fa as W,ga as Y,h as H,ha as G,ka as I,l as v,m as x,ma as q,o as d,p as U,q as E,ra as F,t as z,ta as g,u as L,ua as M,wa as P,ya as w,z as p}from"./chunk-VE5QODOT.js";var me=ue(fe());var D=class i{constructor(t){this.firestore=t}getEspecialistasPorEspecialidad(t){return c(this,null,function*(){let e=g(this.firestore,"users"),r=(yield P(e)).docs.map(a=>_({id:a.id},a.data())).filter(a=>this.especialistaValido(a,t));return console.log("Especialistas filtrados:",r),r})}especialistaValido(t,e){return t.role==="especialista"&&t.especialidades.includes(e)}getHorariosPorEspecialista(t){return c(this,null,function*(){let e=g(this.firestore,"horarios"),o=yield P(e),r=yield this.getTurnosPorEspecialista(t);return o.docs.map(a=>{let S=a.data();return _({id:a.id},S)}).filter(a=>a.especialistaId===t&&this.isWithinNext15Days(a.fecha)&&!this.isHorarioOcupado(a,r))})}getTurnosPorEspecialista(t){return c(this,null,function*(){let e=g(this.firestore,"turnos");return(yield P(e)).docs.map(r=>{let a=r.data();return _({id:r.id},a)}).filter(r=>r.especialistaId===t)})}isHorarioOcupado(t,e){let o=new Date(t.fecha),r=new Date(o);return r.setMinutes(r.getMinutes()+30),e.some(a=>{let S=new Date(a.fecha),R=new Date(S);return R.setMinutes(R.getMinutes()+30),S<r&&R>o})}isWithinNext15Days(t){let e=new Date(t),o=new Date,r=new Date;return r.setDate(o.getDate()+15),e>=o&&e<=r}solicitarTurno(t){return c(this,null,function*(){let e=M(g(this.firestore,"turnos"));yield w(e,t)})}static \u0275fac=function(e){return new(e||i)(d(F))};static \u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})};var O=class i{constructor(t,e){this.firestore=t;this.authService=e}horariosApertura={lunes:{apertura:"08:00",cierre:"19:00"},martes:{apertura:"08:00",cierre:"19:00"},mi\u00E9rcoles:{apertura:"08:00",cierre:"19:00"},jueves:{apertura:"08:00",cierre:"19:00"},viernes:{apertura:"08:00",cierre:"19:00"},s\u00E1bado:{apertura:"08:00",cierre:"14:00"},domingo:{apertura:null,cierre:null}};guardarDisponibilidad(t,e){return c(this,null,function*(){let o=M(g(this.firestore,"Disponibilidad"),t);yield w(o,{disponibilidad:e})})}static \u0275fac=function(e){return new(e||i)(d(F),d(h))};static \u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})};function be(i,t){if(i&1&&(n(0,"option",11),m(1),s()),i&2){let e=t.$implicit;l("value",e.nombre),p(),V(e.nombre)}}function ye(i,t){if(i&1&&(n(0,"option",11),m(1),s()),i&2){let e=t.$implicit;l("value",e.nombre),p(),V(e.nombre)}}function Ce(i,t){if(i&1&&(n(0,"option",11),m(1),s()),i&2){let e=t.$implicit;l("value",e.id),p(),B("",e.fecha," - ",e.hora,"")}}function _e(i,t){if(i&1&&(n(0,"div")(1,"label",12),m(2,"Paciente:"),s(),T(3,"input",13),n(4,"label",14),m(5,"DNI:"),s(),T(6,"input",15),n(7,"label",16),m(8,"Obra Social:"),s(),T(9,"input",17),s()),i&2){let e=k();p(3),l("readonly",e.isAdmin),p(3),l("readonly",e.isAdmin),p(3),l("readonly",e.isAdmin)}}function xe(i,t){if(i&1){let e=$();n(0,"app-listado-paciente",18),y("usuarioSeleccionado",function(r){z(e);let a=k();return L(a.setPacienteData(r))}),s()}}var A=class i{constructor(t,e,o,r,a,S){this.especialidadService=t;this.especialistaService=e;this.turnoService=o;this.authService=r;this.fb=a;this.router=S;this.turnoForm=this.fb.group({especialidad:["",u.required],especialista:["",u.required],horario:["",u.required],paciente:["",u.required],dni:["",[u.required,u.pattern(/^[0-9]{8,}$/)]],obraSocial:["",u.required]})}especialidades=[];especialistas=[];horarios=[];turnoForm;isAdmin=!1;isPaciente=!1;usuarioSeleccionado;ngOnInit(){this.cargarEspecialidades(),this.checkUserRole()}cargarEspecialidades(){return c(this,null,function*(){this.especialidades=yield this.especialidadService.getEspecialidades()})}checkUserRole(){return c(this,null,function*(){this.authService.getUser().subscribe(t=>{t&&(this.isAdmin=t.role==="administrador",this.isPaciente=t.role==="paciente")})})}setPacienteData(t){return c(this,null,function*(){this.usuarioSeleccionado=t,t&&this.turnoForm.patchValue({paciente:t.nombre,dni:t.dni,obraSocial:t.obraSocial})})}onEspecialidadChange(t){return c(this,null,function*(){let o=t.target.value;if(console.log("Nombre de especialidad seleccionada:",o),o)try{this.especialistas=yield this.especialistaService.getEspecialistasPorEspecialidad(o),console.log("Especialistas cargados:",this.especialistas)}catch(r){console.error("Error al cargar especialistas:",r),me.default.fire("Error","No se pudieron cargar los especialistas","error")}else this.especialistas=[]})}onEspecialistaChange(t){return c(this,null,function*(){let o=t.target.value;this.horarios=yield this.especialistaService.getHorariosPorEspecialista(o)})}solicitarTurno(){return c(this,null,function*(){})}static \u0275fac=function(e){return new(e||i)(f(se),f(D),f(O),f(h),f(re),f(I))};static \u0275cmp=U({type:i,selectors:[["app-solicitar-turno"]],decls:17,vars:6,consts:[[3,"ngSubmit","formGroup"],["for","especialidad"],["id","especialidad","formControlName","especialidad",3,"change"],[3,"value",4,"ngFor","ngForOf"],["for","especialista"],["id","especialista","formControlName","especialista",3,"change"],["for","horario"],["id","horario","formControlName","horario"],[4,"ngIf"],[3,"usuarioSeleccionado",4,"ngIf"],["type","submit"],[3,"value"],["for","paciente"],["id","paciente","formControlName","paciente","type","text",3,"readonly"],["for","dni"],["id","dni","formControlName","dni","type","text",3,"readonly"],["for","obraSocial"],["id","obraSocial","formControlName","obraSocial","type","text",3,"readonly"],[3,"usuarioSeleccionado"]],template:function(e,o){e&1&&(n(0,"form",0),y("ngSubmit",function(){return o.solicitarTurno()}),n(1,"label",1),m(2,"Especialidad:"),s(),n(3,"select",2),y("change",function(a){return o.onEspecialidadChange(a)}),b(4,be,2,2,"option",3),s(),n(5,"label",4),m(6,"Especialista:"),s(),n(7,"select",5),y("change",function(a){return o.onEspecialistaChange(a)}),b(8,ye,2,2,"option",3),s(),n(9,"label",6),m(10,"Horario:"),s(),n(11,"select",7),b(12,Ce,2,3,"option",3),s(),b(13,_e,10,3,"div",8)(14,xe,1,0,"app-listado-paciente",9),n(15,"button",10),m(16,"Solicitar Turno"),s()()),e&2&&(l("formGroup",o.turnoForm),p(4),l("ngForOf",o.especialidades),p(4),l("ngForOf",o.especialistas),p(4),l("ngForOf",o.horarios),p(),l("ngIf",o.isAdmin),p(),l("ngIf",o.isAdmin))},dependencies:[W,Y,X,ie,oe,J,te,K,Q,Z,ee,ce],styles:['@charset "UTF-8";form[_ngcontent-%COMP%]{max-width:800px;margin:20px auto;padding:30px;border:2px solid #007bff;border-radius:15px;background-color:#e0f7fa;box-shadow:0 4px 20px #0003}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px;display:block;color:#007bff}input[type=text][_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #007bff;border-radius:6px;font-size:16px;margin-bottom:15px;box-sizing:border-box;transition:border-color .3s,background-color .3s;background-color:#f1f1f1}input[type=text][_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{border-color:#0056b3;outline:none;background-color:#fff}div[ngIf][_ngcontent-%COMP%]{color:#dc3545;font-size:.9em;margin-top:-10px;margin-bottom:10px}button[type=submit][_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 15px;border:none;border-radius:6px;cursor:pointer;transition:background-color .3s,transform .2s;width:100%;font-size:1em}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:translateY(-2px)}div[_ngcontent-%COMP%]{margin-bottom:20px}div[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ngIf[_ngcontent-%COMP%]{margin-bottom:20px}']})};var N=class i{constructor(t,e){this.authService=t;this.router=e}canActivate(t,e){return this.authService.getUser().pipe(H(o=>o&&(o.role==="administrador"||o.role==="paciente")?!0:(this.router.navigate(["/bienvenida"]),console.log("Acceso denegado: no es administrador ni paciente"),!1)))}static \u0275fac=function(e){return new(e||i)(d(h),d(I))};static \u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ee=[{path:"solicitar-turno",component:A,canActivate:[N]}],j=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=E({type:i});static \u0275inj=x({imports:[q.forChild(Ee),q]})};var de=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=E({type:i});static \u0275inj=x({imports:[G,j,ne,le,G,ae]})};export{de as SeccionTurnosModule};
